import{k as T}from"./useFocusRing-DzGSygZM.js";import{r as o,R as m}from"./index-BZISi7jw.js";import{c as U,b as x,e as P,a as k}from"./index-IBhSrjl6.js";import{$ as Q}from"./useLabel-Hju3pN3c.js";import{a as q,$ as Y}from"./utils-CoJ4Pv5P.js";import{$ as z}from"./Text-CZDyhmV-.js";import{$ as G}from"./filterDOMProps-CeZl_uWj.js";const M={badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1,valid:!0},L={...M,customError:!0,valid:!1},$={isInvalid:!1,validationDetails:M,validationErrors:[]},R=o.createContext({}),B="__formValidationState"+Date.now();function de(t){if(t[B]){let{realtimeValidation:e,displayValidation:a,updateValidation:i,resetValidation:r,commitValidation:l}=t[B];return{realtimeValidation:e,displayValidation:a,updateValidation:i,resetValidation:r,commitValidation:l}}return H(t)}function H(t){let{isInvalid:e,validationState:a,name:i,value:r,builtinValidation:l,validate:s,validationBehavior:n="aria"}=t;a&&(e||(e=a==="invalid"));let d=e!==void 0?{isInvalid:e,validationErrors:[],validationDetails:L}:null,v=o.useMemo(()=>{if(!s||r==null)return null;let c=J(s,r);return D(c)},[s,r]);l!=null&&l.validationDetails.valid&&(l=void 0);let f=o.useContext(R),u=o.useMemo(()=>i?Array.isArray(i)?i.flatMap(c=>I(f[c])):I(f[i]):[],[f,i]),[F,j]=o.useState(f),[S,p]=o.useState(!1);f!==F&&(j(f),p(!1));let E=o.useMemo(()=>D(S?[]:u),[S,u]),C=o.useRef($),[V,g]=o.useState($),b=o.useRef($),N=()=>{if(!O)return;h(!1);let c=v||l||C.current;y(c,b.current)||(b.current=c,g(c))},[O,h]=o.useState(!1);return o.useEffect(N),{realtimeValidation:d||E||v||l||$,displayValidation:n==="native"?d||E||V:d||E||v||l||V,updateValidation(c){n==="aria"&&!y(V,c)?g(c):C.current=c},resetValidation(){let c=$;y(c,b.current)||(b.current=c,g(c)),n==="native"&&h(!1),p(!0)},commitValidation(){n==="native"&&h(!0),p(!0)}}}function I(t){return t?Array.isArray(t)?t:[t]:[]}function J(t,e){if(typeof t=="function"){let a=t(e);if(a&&typeof a!="boolean")return I(a)}return[]}function D(t){return t.length?{isInvalid:!0,validationErrors:t,validationDetails:L}:null}function y(t,e){return t===e?!0:!!t&&!!e&&t.isInvalid===e.isInvalid&&t.validationErrors.length===e.validationErrors.length&&t.validationErrors.every((a,i)=>a===e.validationErrors[i])&&Object.entries(t.validationDetails).every(([a,i])=>e.validationDetails[a]===i)}function se(...t){let e=new Set,a=!1,i={...M};for(let s of t){var r,l;for(let n of s.validationErrors)e.add(n);a||(a=s.isInvalid);for(let n in i)(r=i)[l=n]||(r[l]=s.validationDetails[n])}return i.valid=!a,{isInvalid:a,validationErrors:[...e],validationDetails:i}}function ce(t,e,a){let{validationBehavior:i,focus:r}=t;U(()=>{if(i==="native"&&(a!=null&&a.current)&&!a.current.disabled){let d=e.realtimeValidation.isInvalid?e.realtimeValidation.validationErrors.join(" ")||"Invalid value.":"";a.current.setCustomValidity(d),a.current.hasAttribute("title")||(a.current.title=""),e.realtimeValidation.isInvalid||e.updateValidation(W(a.current))}});let l=x(()=>{e.resetValidation()}),s=x(d=>{var v;e.displayValidation.isInvalid||e.commitValidation();let f=a==null||(v=a.current)===null||v===void 0?void 0:v.form;if(!d.defaultPrevented&&a&&f&&X(f)===a.current){var u;r?r():(u=a.current)===null||u===void 0||u.focus(),T("keyboard")}d.preventDefault()}),n=x(()=>{e.commitValidation()});o.useEffect(()=>{let d=a==null?void 0:a.current;if(!d)return;let v=d.form;return d.addEventListener("invalid",s),d.addEventListener("change",n),v==null||v.addEventListener("reset",l),()=>{d.removeEventListener("invalid",s),d.removeEventListener("change",n),v==null||v.removeEventListener("reset",l)}},[a,s,n,l,i])}function K(t){let e=t.validity;return{badInput:e.badInput,customError:e.customError,patternMismatch:e.patternMismatch,rangeOverflow:e.rangeOverflow,rangeUnderflow:e.rangeUnderflow,stepMismatch:e.stepMismatch,tooLong:e.tooLong,tooShort:e.tooShort,typeMismatch:e.typeMismatch,valueMissing:e.valueMissing,valid:e.valid}}function W(t){return{isInvalid:!t.validity.valid,validationDetails:K(t),validationErrors:t.validationMessage?[t.validationMessage]:[]}}function X(t){for(let e=0;e<t.elements.length;e++){let a=t.elements[e];if(!a.validity.valid)return a}return null}function ve(t){let{description:e,errorMessage:a,isInvalid:i,validationState:r}=t,{labelProps:l,fieldProps:s}=Q(t),n=P([!!e,!!a,i,r]),d=P([!!e,!!a,i,r]);return s=k(s,{"aria-describedby":[n,d,t["aria-describedby"]].filter(Boolean).join(" ")||void 0}),{labelProps:l,fieldProps:s,descriptionProps:{id:n},errorMessageProps:{id:d}}}const A=o.createContext(null),fe=o.forwardRef(function(e,a){let i=o.useContext(A);return i!=null&&i.isInvalid?m.createElement(Z,{...e,ref:a}):null}),Z=o.forwardRef((t,e)=>{let a=o.useContext(A),i=G(t),r=q({...t,defaultClassName:"react-aria-FieldError",defaultChildren:a.validationErrors.length===0?void 0:a.validationErrors.join(" "),values:a});return r.children==null?null:m.createElement(z,{slot:"errorMessage",...i,...r,ref:e})}),w=o.createContext(null),ue=o.forwardRef(function(e,a){[e,a]=Y(e,a,w);let{validationErrors:i,validationBehavior:r="native",children:l,className:s,...n}=e;return m.createElement("form",{noValidate:r!=="native",...n,ref:a,className:s||"react-aria-Form"},m.createElement(w.Provider,{value:{...e,validationBehavior:r}},m.createElement(R.Provider,{value:i??{}},l)))});export{de as $,ve as a,ce as b,ue as c,w as d,A as e,fe as f,B as g,$ as h,se as i,M as j};
