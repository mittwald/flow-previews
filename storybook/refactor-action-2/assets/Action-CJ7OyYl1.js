var $=Object.defineProperty;var G=(t,e,n)=>e in t?$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var p=(t,e,n)=>(G(t,typeof e!="symbol"?e+"":e,n),n);import{r as f,R as d}from"./index-uCp2LrAq.js";import{m as D,o as M,b as h,P as U}from"./flowComponent-CYso3G7U.js";import{u as P,R as j}from"./Render-Bcmr6Csp.js";import{W as z}from"./Wrap-DQq6jo70.js";const T=f.createContext(void 0),te=T.Provider;class C{constructor(e=!1){p(this,"isOpen");D(this,{isOpen:M,open:h.bound,close:h.bound,toggle:h.bound,setOpen:h.bound}),this.isOpen=e}static useNew(e){return f.useState(new C(e))[0]}open(){this.isOpen=!0}close(){this.isOpen=!1}toggle(){this.isOpen=!this.isOpen}setOpen(e){this.isOpen=e}useIsOpen(){return P(()=>this.isOpen)}}const H=(t={})=>{const{reuseControllerFromContext:e=!0,defaultOpen:n}=t,i=C.useNew(n),s=f.useContext(T);return e&&s?s:i};class y{constructor(){p(this,"state","isIdle");D(this,{state:M,updateState:h})}static useNew(){return f.useRef(new y).current}updateState(e){this.state=e}useState(){return P(()=>this.state,[this])}}const q=f.createContext({actionProps:{},state:new y,overlayController:new C}),J=q.Provider,B=()=>f.useContext(q),K=t=>({actionProps:t,parentContext:B(),overlayController:H(),state:y.useNew()}),m=()=>{},L=(t,e={})=>{const{onSync:n=m,onAsync:i=m,then:s=m,catch:l=m,finally:c=m}=e;try{const o=t();return o instanceof Promise?(i(),o.then(s).catch(l).finally(c)):(n(),s(o),c(),o)}catch(o){n(),l(o),c()}},F=t=>new Promise(e=>setTimeout(e,t)),x={pending:1e3,succeeded:1500,failed:2e3};class Q{constructor(e,n,i={}){p(this,"options");p(this,"state");p(this,"args");p(this,"isDone",!1);p(this,"error");const{resetAfterDone:s=!0,onFeedbackDone:l=()=>{},showFeedback:c=!1}=i;this.state=e,this.args=n,this.options={resetAfterDone:s,onFeedbackDone:l,showFeedback:c}}onAsyncStart(){this.options.showFeedback=!0,this.state.updateState("isExecuting"),setTimeout(()=>this.startPending(),x.pending)}onSucceeded(){return this.onDone()}async onFailed(e){this.error=e??new Error("Unknown error"),console.error(e),await this.onDone()}async startFailedFeedback(){this.state.updateState("isFailed"),await F(x.failed),this.resetAfterDone()}async startSucceededFeedback(){this.state.updateState("isSucceeded"),await F(x.succeeded),this.resetAfterDone()}resetAfterDone(){this.options.resetAfterDone&&this.state.updateState("isIdle"),this.error||this.options.onFeedbackDone(...this.args)}async onDone(){this.isDone=!0,this.options.showFeedback?this.error?await this.startFailedFeedback():await this.startSucceededFeedback():this.resetAfterDone()}startPending(){this.isDone||this.state.updateState("isPending")}}const I=t=>(...e)=>{const n=[...t],i=n.shift();if(i){const s=i(...e),l=()=>n.length===0?s:I(n)(...e);return s instanceof Promise?s.then(l):l()}},V=()=>{},E=()=>{var n;const t=B(),e=t.actionProps.confirm||t.actionProps.abort?((n=t.parentContext)==null?void 0:n.state)??t.state:t.state;return{state:e,executeAction:async(...i)=>{var u,a;if(t.actionProps.abort){(a=(u=t.parentContext)==null?void 0:u.confirmationModalController)==null||a.close();return}if(t.confirmationModalController){t.confirmationModalController.open();return}const s=new Q(e,i,t.actionProps),l=[];let c,o,r=t;for(;r;){const{actionProps:b,overlayController:R,confirmationModalController:w}=r,{action:O,toggleOverlay:g,openOverlay:A,closeOverlay:S,break:W}=b;if(W)break;if(w)if(c){o=w;break}else c=w;const v=k=>typeof k=="boolean"?R:k;l.push(O||(g?v(g).toggle:A?v(A).open:S?v(S).close:V)),r=r.parentContext}await L(()=>I(l)(i),{onAsync:()=>s.onAsyncStart(),then:()=>s.onSucceeded(),catch:b=>s.onFailed(b)}),o&&o.open(),c&&c.close()}}},N=t=>{const e=C.useNew(),n=K(t),c={Modal:{render:(o,r)=>r.slot!=="actionConfirm"?d.createElement(o,{...r}):d.createElement(j,null,()=>{const u=E().state.useState();f.useEffect(()=>(n.confirmationModalController=e,()=>{n.confirmationModalController=void 0}),[e,n]);const a=u==="isIdle"?r.isDismissable:!1;return d.createElement(o,{...r,controller:e,isDismissable:a})}),ButtonGroup:{Button:{render:(o,r)=>{const u=r.color==="secondary",a=r.color==="primary"||r.color==="danger";return d.createElement(z,{if:u||a},d.createElement(N,{abort:u,confirm:a},d.createElement(o,{...r})))}}}},Button:{render:(o,r)=>{const u=E(),a=u.state.useState();return n.confirmationModalController?d.createElement(o,{...r}):t.abort?d.createElement(o,{...r,onPress:u.executeAction,"aria-disabled":a!=="isIdle"}):d.createElement(o,{...r,onPress:u.executeAction,isPending:a==="isPending","aria-disabled":a==="isExecuting",isSucceeded:a==="isSucceeded",isFailed:a==="isFailed"})}}};return d.createElement(J,{value:n},d.createElement(U,{props:c,dependencies:[e]},t.children))};N.__docgenInfo={description:"",methods:[],displayName:"Action",props:{action:{required:!1,tsType:{name:"signature",type:"function",raw:"(...args: unknown[]) => unknown",signature:{arguments:[{type:{name:"Array",elements:[{name:"unknown"}],raw:"unknown[]"},name:"args",rest:!0}],return:{name:"unknown"}}},description:""},closeOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},confirm:{required:!1,tsType:{name:"boolean"},description:""},abort:{required:!1,tsType:{name:"boolean"},description:""},openOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},toggleOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},break:{required:!1,tsType:{name:"boolean"},description:""},showFeedback:{required:!1,tsType:{name:"boolean"},description:""},isConfirmationAction:{required:!1,tsType:{name:"boolean"},description:"@internal"}},composes:["PropsWithChildren"]};export{N as A,te as O,H as u};
