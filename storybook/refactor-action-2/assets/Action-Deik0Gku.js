var L=Object.defineProperty;var $=(t,e,n)=>e in t?L(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var f=(t,e,n)=>($(t,typeof e!="symbol"?e+"":e,n),n);import{r as m,R as c}from"./index-uCp2LrAq.js";import{m as D,o as M,b as C,P as G,u as U}from"./flowComponent-Dzs9U9nI.js";import{u as T,R as j}from"./Render-DbFvAKKS.js";import{W as z}from"./Wrap-DQq6jo70.js";const q=m.createContext(void 0),ne=q.Provider;class y{constructor(e=!1){f(this,"isOpen");D(this,{isOpen:M,open:C.bound,close:C.bound,toggle:C.bound,setOpen:C.bound}),this.isOpen=e}static useNew(e){return m.useState(new y(e))[0]}open(){this.isOpen=!0}close(){this.isOpen=!1}toggle(){this.isOpen=!this.isOpen}setOpen(e){this.isOpen=e}useIsOpen(){return T(()=>this.isOpen)}}const H=(t={})=>{const{reuseControllerFromContext:e=!0,defaultOpen:n}=t,l=y.useNew(n),s=m.useContext(q);return e&&s?s:l};class b{constructor(){f(this,"state","isIdle");D(this,{state:M,updateState:C})}static useNew(){return m.useRef(new b).current}updateState(e){this.state=e}useState(){return T(()=>this.state,[this])}}const I=m.createContext({actionProps:{},state:new b,overlayController:new y}),J=I.Provider,B=()=>m.useContext(I),K=t=>({actionProps:t,parentContext:B(),overlayController:H(),state:b.useNew()}),h=()=>{},Q=(t,e={})=>{const{onSync:n=h,onAsync:l=h,then:s=h,catch:d=h,finally:p=h}=e;try{const u=t();return u instanceof Promise?(l(),u.then(s).catch(d).finally(p)):(n(),s(u),p(),u)}catch(u){n(),d(u),p()}},P=t=>new Promise(e=>setTimeout(e,t)),O={pending:1e3,succeeded:1500,failed:2e3};class V{constructor(e,n,l={}){f(this,"options");f(this,"state");f(this,"args");f(this,"isDone",!1);f(this,"error");const{resetAfterDone:s=!0,onFeedbackDone:d=()=>{},showFeedback:p=!1}=l;this.state=e,this.args=n,this.options={resetAfterDone:s,onFeedbackDone:d,showFeedback:p}}onAsyncStart(){this.options.showFeedback=!0,this.state.updateState("isExecuting"),setTimeout(()=>this.startPending(),O.pending)}onSucceeded(){return this.onDone()}async onFailed(e){this.error=e??new Error("Unknown error"),console.error(e),await this.onDone()}async startFailedFeedback(){this.state.updateState("isFailed"),await P(O.failed),this.resetAfterDone()}async startSucceededFeedback(){this.state.updateState("isSucceeded"),await P(O.succeeded),this.resetAfterDone()}resetAfterDone(){this.options.resetAfterDone&&this.state.updateState("isIdle"),this.error||this.options.onFeedbackDone(...this.args)}async onDone(){this.isDone=!0,this.options.showFeedback?this.error?await this.startFailedFeedback():await this.startSucceededFeedback():this.resetAfterDone()}startPending(){this.isDone||this.state.updateState("isPending")}}const N=t=>(...e)=>{const n=[...t],l=n.shift();if(l){const s=l(...e),d=()=>n.length===0?s:N(n)(...e);return s instanceof Promise?s.then(d):d()}},X=()=>{},g=()=>{var n;const t=B(),e=t.actionProps.confirm||t.actionProps.abort?((n=t.parentContext)==null?void 0:n.state)??t.state:t.state;return{state:e,execute:async(...l)=>{var o,i;if(t.actionProps.abort){(i=(o=t.parentContext)==null?void 0:o.confirmationModalController)==null||i.close();return}if(t.confirmationModalController){t.confirmationModalController.open();return}const s=new V(e,l,t.actionProps),d=[];let p,u,a=t;for(;a;){const{actionProps:r,overlayController:w,confirmationModalController:x}=a,{action:A,toggleOverlay:k,openOverlay:S,closeOverlay:E,break:W}=r;if(W)break;if(x)if(p){u=x;break}else p=x;const v=F=>typeof F=="boolean"?w:F;d.push(A||(k?v(k).toggle:S?v(S).open:E?v(E).close:X)),a=a.parentContext}await Q(()=>N(d)(l),{onAsync:()=>s.onAsyncStart(),then:()=>s.onSucceeded(),catch:r=>s.onFailed(r)}),u&&u.open(),p&&p.close()}}},R=t=>{const e=y.useNew(),n=K(t),u={Modal:{render:(a,o)=>o.slot!=="actionConfirm"?c.createElement(a,{...o}):c.createElement(j,null,()=>{const i=g().state.useState();m.useEffect(()=>(n.confirmationModalController=e,()=>{n.confirmationModalController=void 0}),[e,n]);const r=i==="isIdle"?o.isDismissable:!1;return c.createElement(a,{...o,controller:e,isDismissable:r})}),ButtonGroup:{Button:{render:(a,o)=>{const i=o.color==="secondary",r=o.color==="primary"||o.color==="danger";return c.createElement(z,{if:i||r},c.createElement(R,{abort:i,confirm:r},c.createElement(a,{...o})))}}}},Button:{render:(a,o)=>{const i=g(),r=i.state.useState();return n.confirmationModalController?c.createElement(a,{...o,onPress:i.execute}):t.abort?c.createElement(a,{...o,onPress:i.execute,"aria-disabled":r!=="isIdle"}):c.createElement(a,{...o,onPress:i.execute,isPending:r==="isPending","aria-disabled":r==="isExecuting",isSucceeded:r==="isSucceeded",isFailed:r==="isFailed"})}},Link:{render:(a,o)=>{const i=U("Link",o),r=g(),w=r.state.useState();return n.confirmationModalController?c.createElement(a,{...i}):c.createElement(a,{...i,onPress:r.execute,href:void 0,"aria-disabled":w!=="isIdle"})}}};return c.createElement(J,{value:n},c.createElement(G,{props:u,dependencies:[e],mergeInParentContext:!0},t.children))};R.__docgenInfo={description:"",methods:[],displayName:"Action",props:{action:{required:!1,tsType:{name:"signature",type:"function",raw:"(...args: unknown[]) => unknown",signature:{arguments:[{type:{name:"Array",elements:[{name:"unknown"}],raw:"unknown[]"},name:"args",rest:!0}],return:{name:"unknown"}}},description:""},closeOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},confirm:{required:!1,tsType:{name:"boolean"},description:""},abort:{required:!1,tsType:{name:"boolean"},description:""},openOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},toggleOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},break:{required:!1,tsType:{name:"boolean"},description:""},showFeedback:{required:!1,tsType:{name:"boolean"},description:""},isConfirmationAction:{required:!1,tsType:{name:"boolean"},description:"@internal"}},composes:["PropsWithChildren"]};export{R as A,ne as O,H as u};
