var J=Object.defineProperty;var K=(t,e,n)=>e in t?J(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var l=(t,e,n)=>(K(t,typeof e!="symbol"?e+"":e,n),n);import{r as u,R as a}from"./index-uCp2LrAq.js";import{m as I,o as N,b as m,P as R}from"./flowComponent-zjeizx3W.js";import{u as B}from"./useSelector-CdXa9UQ6.js";import{W as Q}from"./Wrap-DQq6jo70.js";const W=u.createContext(void 0),ce=W.Provider;class d{constructor(e=!1){l(this,"isOpen");I(this,{isOpen:N,open:m.bound,close:m.bound,toggle:m.bound,setOpen:m.bound}),this.isOpen=e}static useNew(e){return u.useRef(new d(e)).current}open(){this.isOpen=!0}close(){this.isOpen=!1}toggle(){this.isOpen=!this.isOpen}setOpen(e){this.isOpen=e}useIsOpen(){return B(()=>this.isOpen)}}const T=(t={})=>{const{reuseControllerFromContext:e=!0,defaultOpen:n}=t,o=d.useNew(n),s=u.useContext(W);return e&&s?s:o};class y{constructor(){l(this,"state","isIdle");I(this,{state:N,updateState:m})}static useNew(){return u.useRef(new y).current}updateState(e){this.state=e}useState(){return B(()=>this.state,[this])}}const $=u.createContext({actionProps:{},state:new y,overlayController:new d,confirmationModalController:new d,needsConfirmation:!1}),V=$.Provider,p=()=>u.useContext($),X=t=>({actionProps:t,parentContext:p(),overlayController:T(),state:y.useNew(),confirmationModalController:T(),needsConfirmation:!1}),f=()=>{},Y=(t,e={})=>{const{onSync:n=f,onAsync:o=f,then:s=f,catch:r=f,finally:c=f}=e;try{const i=t();return i instanceof Promise?(o(),i.then(s).catch(r).finally(c)):(n(),s(i),c(),i)}catch(i){n(),r(i),c()}},q=t=>new Promise(e=>setTimeout(e,t)),g={pending:1e3,succeeded:1500,failed:2e3};class Z{constructor(e,n,o={}){l(this,"options");l(this,"state");l(this,"args");l(this,"isDone",!1);l(this,"error");const{resetAfterDone:s=!0,onFeedbackDone:r=()=>{},showFeedback:c=!1}=o;this.state=e,this.args=n,this.options={resetAfterDone:s,onFeedbackDone:r,showFeedback:c}}onAsyncStart(){this.options.showFeedback=!0,this.state.updateState("isExecuting"),setTimeout(()=>this.startPending(),g.pending)}onSucceeded(){return this.onDone()}async onFailed(e){this.error=e??new Error("Unknown error"),console.error(e),await this.onDone()}async startFailedFeedback(){this.state.updateState("isFailed"),await q(g.failed),this.resetAfterDone()}async startSucceededFeedback(){this.state.updateState("isSucceeded"),await q(g.succeeded),this.resetAfterDone()}resetAfterDone(){this.options.resetAfterDone&&this.state.updateState("isIdle"),this.error||this.options.onFeedbackDone(...this.args)}async onDone(){this.isDone=!0,this.options.showFeedback?this.error?await this.startFailedFeedback():await this.startSucceededFeedback():this.resetAfterDone()}startPending(){this.isDone||this.state.updateState("isPending")}}const G=t=>(...e)=>{const n=[...t],o=n.shift();if(o){const s=o(...e),r=()=>n.length===0?s:G(n)(...e);return s instanceof Promise?s.then(r):r()}},_=()=>{},v=()=>{var n;const t=p(),e=t.actionProps.confirm||t.actionProps.abort?((n=t.parentContext)==null?void 0:n.state)??t.state:t.state;return{state:e,execute:async(...o)=>{var k;const{actionProps:s,confirmationModalController:r,needsConfirmation:c,parentContext:i}=t;if(s.abort){(k=i==null?void 0:i.confirmationModalController)==null||k.close();return}if(c&&!r.isOpen){r.open();return}const b=new Z(e,o,s),A=[];let C,x,h=t;for(;h;){const{actionProps:w,overlayController:j,confirmationModalController:S,needsConfirmation:z}=h,{action:E,toggleOverlay:F,openOverlay:P,closeOverlay:D,break:H}=w;if(H)break;if(z)if(C){x=S;break}else C=S;const O=M=>typeof M=="boolean"?j:M;A.push(E||(F?O(F).toggle:P?O(P).open:D?O(D).close:_)),h=h.parentContext}await Y(()=>G(A)(o),{onAsync:()=>b.onAsyncStart(),then:()=>b.onSucceeded(),catch:w=>b.onFailed(w)}),x&&x.open(),C&&C.close()}}},L=(t,e)=>{const{actionProps:n,needsConfirmation:o}=p(),s=v(),r=s.state.useState();return o?a.createElement(t,{...e,onPress:s.execute}):n.abort?a.createElement(t,{...e,onPress:s.execute,"aria-disabled":r!=="isIdle"}):a.createElement(t,{...e,onPress:s.execute,isPending:r==="isPending","aria-disabled":r==="isExecuting",isSucceeded:r==="isSucceeded",isFailed:r==="isFailed"})},ee=(t,e)=>{const{needsConfirmation:n}=p(),o=v(),s=o.state.useState();return n?a.createElement(t,{...e,onPress:o.execute}):a.createElement(t,{...e,onPress:o.execute,"aria-disabled":s!=="isIdle"})},te=(t,e)=>{const n=e.color==="secondary",o=e.color==="primary"||e.color==="danger"||e.color==="accent";if(!o&&!n)return a.createElement(t,{...e});const s={Button:{render:L}};return a.createElement(R,{props:s},a.createElement(U,{abort:n,confirm:o},a.createElement(t,{...e})))},ne=(t,e)=>{if(e.slot!=="actionConfirm")return a.createElement(t,{...e});const n=p(),o=v().state.useState();u.useEffect(()=>(n.needsConfirmation=!0,()=>{n.needsConfirmation=!1}),[n]);const s=o==="isIdle"?e.isDismissable:!1;return a.createElement(t,{...e,controller:n.confirmationModalController,isDismissable:s})},U=t=>{const{children:e,...n}=t,o=X(n),s=!!o.parentContext&&!!o.parentContext.parentContext,r=d.useNew(),c={Modal:{render:ne,ButtonGroup:{Button:{render:te}}},Button:{render:L},Link:{render:ee}};return a.createElement(V,{value:o},a.createElement(Q,{if:!s},a.createElement(R,{props:c,dependencies:[r,o],mergeInParentContext:!0},e)))};U.__docgenInfo={description:"",methods:[],displayName:"Action",props:{action:{required:!1,tsType:{name:"signature",type:"function",raw:"(...args: unknown[]) => unknown",signature:{arguments:[{type:{name:"Array",elements:[{name:"unknown"}],raw:"unknown[]"},name:"args",rest:!0}],return:{name:"unknown"}}},description:""},closeOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},openOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},toggleOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},break:{required:!1,tsType:{name:"boolean"},description:""},showFeedback:{required:!1,tsType:{name:"boolean"},description:""},isConfirmationAction:{required:!1,tsType:{name:"boolean"},description:"@internal"},confirm:{required:!1,tsType:{name:"boolean"},description:"@internal"},abort:{required:!1,tsType:{name:"boolean"},description:"@internal"}},composes:["PropsWithChildren"]};export{U as A,ce as O,T as u};
