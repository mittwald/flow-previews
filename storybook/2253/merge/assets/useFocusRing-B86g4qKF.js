import{i as P,a as x,j as G,k as H,l as L,m as y,n as C,e as k,o as S,f as V}from"./useFocus-Fr_BfSOs.js";import{r}from"./iframe-C5hcdLE6.js";function W(){let c=r.useRef(new Map),b=r.useCallback((e,n,i,t)=>{let a=t?.once?(...f)=>{c.current.delete(i),i(...f)}:i;c.current.set(i,{type:n,eventTarget:e,fn:a,options:t}),e.addEventListener(n,a,t)},[]),u=r.useCallback((e,n,i,t)=>{var a;let f=((a=c.current.get(i))===null||a===void 0?void 0:a.fn)||i;e.removeEventListener(n,f,t),c.current.delete(i)},[]),l=r.useCallback(()=>{c.current.forEach((e,n)=>{u(e.eventTarget,e.type,n,e.options)})},[u]);return r.useEffect(()=>l,[l]),{addGlobalListener:b,removeGlobalListener:u,removeAllGlobalListeners:l}}function w(c){let{isDisabled:b,onBlurWithin:u,onFocusWithin:l,onFocusWithinChange:e}=c,n=r.useRef({isFocusWithin:!1}),{addGlobalListener:i,removeAllGlobalListeners:t}=W(),a=r.useCallback(o=>{o.currentTarget.contains(o.target)&&n.current.isFocusWithin&&!o.currentTarget.contains(o.relatedTarget)&&(n.current.isFocusWithin=!1,t(),u&&u(o),e&&e(!1))},[u,e,n,t]),f=P(a),g=r.useCallback(o=>{if(!o.currentTarget.contains(o.target))return;const v=x(o.target),d=G(v);if(!n.current.isFocusWithin&&d===H(o.nativeEvent)){l&&l(o),e&&e(!0),n.current.isFocusWithin=!0,f(o);let h=o.currentTarget;i(v,"focus",s=>{if(n.current.isFocusWithin&&!L(h,s.target)){let p=new v.defaultView.FocusEvent("blur",{relatedTarget:s.target});y(p,h);let $=C(p);a($)}},{capture:!0})}},[l,e,f,i,a]);return b?{focusWithinProps:{onFocus:void 0,onBlur:void 0}}:{focusWithinProps:{onFocus:g,onBlur:a}}}let m=!1,F=0;function D(){m=!0,setTimeout(()=>{m=!1},50)}function T(c){c.pointerType==="touch"&&D()}function A(){if(!(typeof document>"u"))return F===0&&typeof PointerEvent<"u"&&document.addEventListener("pointerup",T),F++,()=>{F--,!(F>0)&&typeof PointerEvent<"u"&&document.removeEventListener("pointerup",T)}}function M(c){let{onHoverStart:b,onHoverChange:u,onHoverEnd:l,isDisabled:e}=c,[n,i]=r.useState(!1),t=r.useRef({isHovered:!1,ignoreEmulatedMouseEvents:!1,pointerType:"",target:null}).current;r.useEffect(A,[]);let{addGlobalListener:a,removeAllGlobalListeners:f}=W(),{hoverProps:g,triggerHoverEnd:o}=r.useMemo(()=>{let v=(s,p)=>{if(t.pointerType=p,e||p==="touch"||t.isHovered||!s.currentTarget.contains(s.target))return;t.isHovered=!0;let $=s.currentTarget;t.target=$,a(x(s.target),"pointerover",E=>{t.isHovered&&t.target&&!L(t.target,E.target)&&d(E,E.pointerType)},{capture:!0}),b&&b({type:"hoverstart",target:$,pointerType:p}),u&&u(!0),i(!0)},d=(s,p)=>{let $=t.target;t.pointerType="",t.target=null,!(p==="touch"||!t.isHovered||!$)&&(t.isHovered=!1,f(),l&&l({type:"hoverend",target:$,pointerType:p}),u&&u(!1),i(!1))},h={};return typeof PointerEvent<"u"&&(h.onPointerEnter=s=>{m&&s.pointerType==="mouse"||v(s,s.pointerType)},h.onPointerLeave=s=>{!e&&s.currentTarget.contains(s.target)&&d(s,s.pointerType)}),{hoverProps:h,triggerHoverEnd:d}},[b,u,l,e,t,a,f]);return r.useEffect(()=>{e&&o({currentTarget:t.target},t.pointerType)},[e]),{hoverProps:g,isHovered:n}}function R(c={}){let{autoFocus:b=!1,isTextInput:u,within:l}=c,e=r.useRef({isFocused:!1,isFocusVisible:b||k()}),[n,i]=r.useState(!1),[t,a]=r.useState(()=>e.current.isFocused&&e.current.isFocusVisible),f=r.useCallback(()=>a(e.current.isFocused&&e.current.isFocusVisible),[]),g=r.useCallback(d=>{e.current.isFocused=d,i(d),f()},[f]);S(d=>{e.current.isFocusVisible=d,f()},[],{isTextInput:u});let{focusProps:o}=V({isDisabled:l,onFocusChange:g}),{focusWithinProps:v}=w({isDisabled:!l,onFocusWithinChange:g});return{isFocused:n,isFocusVisible:t,focusProps:l?v:o}}export{M as $,R as a,w as b,W as c};
