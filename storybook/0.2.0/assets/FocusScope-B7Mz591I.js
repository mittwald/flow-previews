import{c as z,d as m,e as U}from"./useFocusRing-Jnne1fGl.js";import{c as g}from"./index-CoqFY4cC.js";import{r as N,R as L}from"./index-Cf9XvIV_.js";function q(e){const t=z(e);if(!(e instanceof t.HTMLElement)&&!(e instanceof t.SVGElement))return!1;let{display:n,visibility:o}=e.style,r=n!=="none"&&o!=="hidden"&&o!=="collapse";if(r){const{getComputedStyle:u}=e.ownerDocument.defaultView;let{display:d,visibility:a}=u(e);r=d!=="none"&&a!=="hidden"&&a!=="collapse"}return r}function H(e,t){return!e.hasAttribute("hidden")&&!e.hasAttribute("data-react-aria-prevent-focus")&&(e.nodeName==="DETAILS"&&t&&t.nodeName!=="SUMMARY"?e.hasAttribute("open"):!0)}function V(e,t){return e.nodeName!=="#comment"&&q(e)&&H(e,t)&&(!e.parentElement||V(e.parentElement,e))}const D=L.createContext(null),C="react-aria-focus-scope-restore";let f=null;function ne(e){let{children:t,contain:n,restoreFocus:o,autoFocus:r}=e,u=N.useRef(null),d=N.useRef(null),a=N.useRef([]),{parentNode:b}=N.useContext(D)||{},i=N.useMemo(()=>new k({scopeRef:a}),[a]);g(()=>{let v=b||p.root;if(p.getTreeNode(v.scopeRef)&&f&&!R(f,v.scopeRef)){let s=p.getTreeNode(f);s&&(v=s)}v.addChild(i),p.addNode(i)},[i,b]),g(()=>{let v=p.getTreeNode(a);v&&(v.contain=!!n)},[n]),g(()=>{var v;let s=(v=u.current)===null||v===void 0?void 0:v.nextSibling,$=[],y=F=>F.stopPropagation();for(;s&&s!==d.current;)$.push(s),s.addEventListener(C,y),s=s.nextSibling;return a.current=$,()=>{for(let F of $)F.removeEventListener(C,y)}},[t]),X(a,o,n),Y(a,n),Z(a,o,n),Q(a,r),N.useEffect(()=>{const v=m(a.current?a.current[0]:void 0).activeElement;let s=null;if(T(v,a.current)){for(let $ of p.traverse())$.scopeRef&&T(v,$.scopeRef.current)&&(s=$);s===p.getTreeNode(a)&&(f=s.scopeRef)}},[a]),g(()=>()=>{var v,s,$;let y=($=(s=p.getTreeNode(a))===null||s===void 0||(v=s.parent)===null||v===void 0?void 0:v.scopeRef)!==null&&$!==void 0?$:null;(a===f||R(a,f))&&(!y||p.getTreeNode(y))&&(f=y),p.removeTreeNode(a)},[a]);let l=N.useMemo(()=>W(a),[]),c=N.useMemo(()=>({focusManager:l,parentNode:i}),[i,l]);return L.createElement(D.Provider,{value:c},L.createElement("span",{"data-focus-scope-start":!0,hidden:!0,ref:u}),t,L.createElement("span",{"data-focus-scope-end":!0,hidden:!0,ref:d}))}function W(e){return{focusNext(t={}){let n=e.current,{from:o,tabbable:r,wrap:u,accept:d}=t,a=o||m(n[0]).activeElement,b=n[0].previousElementSibling,i=x(n),l=h(i,{tabbable:r,accept:d},n);l.currentNode=T(a,n)?a:b;let c=l.nextNode();return!c&&u&&(l.currentNode=b,c=l.nextNode()),c&&E(c,!0),c},focusPrevious(t={}){let n=e.current,{from:o,tabbable:r,wrap:u,accept:d}=t,a=o||m(n[0]).activeElement,b=n[n.length-1].nextElementSibling,i=x(n),l=h(i,{tabbable:r,accept:d},n);l.currentNode=T(a,n)?a:b;let c=l.previousNode();return!c&&u&&(l.currentNode=b,c=l.previousNode()),c&&E(c,!0),c},focusFirst(t={}){let n=e.current,{tabbable:o,accept:r}=t,u=x(n),d=h(u,{tabbable:o,accept:r},n);d.currentNode=n[0].previousElementSibling;let a=d.nextNode();return a&&E(a,!0),a},focusLast(t={}){let n=e.current,{tabbable:o,accept:r}=t,u=x(n),d=h(u,{tabbable:o,accept:r},n);d.currentNode=n[n.length-1].nextElementSibling;let a=d.previousNode();return a&&E(a,!0),a}}}const A=["input:not([disabled]):not([type=hidden])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[contenteditable]"],G=A.join(":not([hidden]),")+",[tabindex]:not([disabled]):not([hidden])";A.push('[tabindex]:not([tabindex="-1"]):not([disabled])');const J=A.join(':not([hidden]):not([tabindex="-1"]),');function x(e){return e[0].parentElement}function S(e){let t=p.getTreeNode(f);for(;t&&t.scopeRef!==e;){if(t.contain)return!1;t=t.parent}return!0}function Y(e,t){let n=N.useRef(void 0),o=N.useRef(void 0);g(()=>{let r=e.current;if(!t){o.current&&(cancelAnimationFrame(o.current),o.current=void 0);return}const u=m(r?r[0]:void 0);let d=i=>{if(i.key!=="Tab"||i.altKey||i.ctrlKey||i.metaKey||!S(e)||i.isComposing)return;let l=u.activeElement,c=e.current;if(!c||!T(l,c))return;let v=x(c),s=h(v,{tabbable:!0},c);if(!l)return;s.currentNode=l;let $=i.shiftKey?s.previousNode():s.nextNode();$||(s.currentNode=i.shiftKey?c[c.length-1].nextElementSibling:c[0].previousElementSibling,$=i.shiftKey?s.previousNode():s.nextNode()),i.preventDefault(),$&&E($,!0)},a=i=>{(!f||R(f,e))&&T(i.target,e.current)?(f=e,n.current=i.target):S(e)&&!w(i.target,e)?n.current?n.current.focus():f&&f.current&&M(f.current):S(e)&&(n.current=i.target)},b=i=>{o.current&&cancelAnimationFrame(o.current),o.current=requestAnimationFrame(()=>{if(u.activeElement&&S(e)&&!w(u.activeElement,e))if(f=e,u.body.contains(i.target)){var l;n.current=i.target,(l=n.current)===null||l===void 0||l.focus()}else f.current&&M(f.current)})};return u.addEventListener("keydown",d,!1),u.addEventListener("focusin",a,!1),r==null||r.forEach(i=>i.addEventListener("focusin",a,!1)),r==null||r.forEach(i=>i.addEventListener("focusout",b,!1)),()=>{u.removeEventListener("keydown",d,!1),u.removeEventListener("focusin",a,!1),r==null||r.forEach(i=>i.removeEventListener("focusin",a,!1)),r==null||r.forEach(i=>i.removeEventListener("focusout",b,!1))}},[e,t]),g(()=>()=>{o.current&&cancelAnimationFrame(o.current)},[o])}function B(e){return w(e)}function T(e,t){return!e||!t?!1:t.some(n=>n.contains(e))}function w(e,t=null){if(e instanceof Element&&e.closest("[data-react-aria-top-layer]"))return!0;for(let{scopeRef:n}of p.traverse(p.getTreeNode(t)))if(n&&T(e,n.current))return!0;return!1}function re(e){return w(e,f)}function R(e,t){var n;let o=(n=p.getTreeNode(t))===null||n===void 0?void 0:n.parent;for(;o;){if(o.scopeRef===e)return!0;o=o.parent}return!1}function E(e,t=!1){if(e!=null&&!t)try{U(e)}catch{}else if(e!=null)try{e.focus()}catch{}}function j(e,t=!0){let n=e[0].previousElementSibling,o=x(e),r=h(o,{tabbable:t},e);r.currentNode=n;let u=r.nextNode();return t&&!u&&(o=x(e),r=h(o,{tabbable:!1},e),r.currentNode=n,u=r.nextNode()),u}function M(e,t=!0){E(j(e,t))}function Q(e,t){const n=L.useRef(t);N.useEffect(()=>{if(n.current){f=e;const o=m(e.current?e.current[0]:void 0);!T(o.activeElement,f.current)&&e.current&&M(e.current)}n.current=!1},[e])}function X(e,t,n){g(()=>{if(t||n)return;let o=e.current;const r=m(o?o[0]:void 0);let u=d=>{let a=d.target;T(a,e.current)?f=e:B(a)||(f=null)};return r.addEventListener("focusin",u,!1),o==null||o.forEach(d=>d.addEventListener("focusin",u,!1)),()=>{r.removeEventListener("focusin",u,!1),o==null||o.forEach(d=>d.removeEventListener("focusin",u,!1))}},[e,t,n])}function I(e){let t=p.getTreeNode(f);for(;t&&t.scopeRef!==e;){if(t.nodeToRestore)return!1;t=t.parent}return(t==null?void 0:t.scopeRef)===e}function Z(e,t,n){const o=N.useRef(typeof document<"u"?m(e.current?e.current[0]:void 0).activeElement:null);g(()=>{let r=e.current;const u=m(r?r[0]:void 0);if(!t||n)return;let d=()=>{(!f||R(f,e))&&T(u.activeElement,e.current)&&(f=e)};return u.addEventListener("focusin",d,!1),r==null||r.forEach(a=>a.addEventListener("focusin",d,!1)),()=>{u.removeEventListener("focusin",d,!1),r==null||r.forEach(a=>a.removeEventListener("focusin",d,!1))}},[e,n]),g(()=>{const r=m(e.current?e.current[0]:void 0);if(!t)return;let u=d=>{if(d.key!=="Tab"||d.altKey||d.ctrlKey||d.metaKey||!S(e)||d.isComposing)return;let a=r.activeElement;if(!w(a,e)||!I(e))return;let b=p.getTreeNode(e);if(!b)return;let i=b.nodeToRestore,l=h(r.body,{tabbable:!0});l.currentNode=a;let c=d.shiftKey?l.previousNode():l.nextNode();if((!i||!r.body.contains(i)||i===r.body)&&(i=void 0,b.nodeToRestore=void 0),(!c||!w(c,e))&&i){l.currentNode=i;do c=d.shiftKey?l.previousNode():l.nextNode();while(w(c,e));d.preventDefault(),d.stopPropagation(),c?E(c,!0):B(i)?E(i,!0):a.blur()}};return n||r.addEventListener("keydown",u,!0),()=>{n||r.removeEventListener("keydown",u,!0)}},[e,t,n]),g(()=>{const r=m(e.current?e.current[0]:void 0);if(!t)return;let u=p.getTreeNode(e);if(u){var d;return u.nodeToRestore=(d=o.current)!==null&&d!==void 0?d:void 0,()=>{let a=p.getTreeNode(e);if(!a)return;let b=a.nodeToRestore;if(t&&b&&(r.activeElement&&w(r.activeElement,e)||r.activeElement===r.body&&I(e))){let i=p.clone();requestAnimationFrame(()=>{if(r.activeElement===r.body){let l=i.getTreeNode(e);for(;l;){if(l.nodeToRestore&&l.nodeToRestore.isConnected){P(l.nodeToRestore);return}l=l.parent}for(l=i.getTreeNode(e);l;){if(l.scopeRef&&l.scopeRef.current&&p.getTreeNode(l.scopeRef)){let c=j(l.scopeRef.current,!0);P(c);return}l=l.parent}}})}}}},[e,t])}function P(e){e.dispatchEvent(new CustomEvent(C,{bubbles:!0,cancelable:!0}))&&E(e)}function h(e,t,n){let o=t!=null&&t.tabbable?J:G,r=m(e).createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode(u){var d;return!(t==null||(d=t.from)===null||d===void 0)&&d.contains(u)?NodeFilter.FILTER_REJECT:u.matches(o)&&V(u)&&(!n||T(u,n))&&(!(t!=null&&t.accept)||t.accept(u))?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});return t!=null&&t.from&&(r.currentNode=t.from),r}function oe(e,t={}){return{focusNext(n={}){let o=e.current;if(!o)return null;let{from:r,tabbable:u=t.tabbable,wrap:d=t.wrap,accept:a=t.accept}=n,b=r||m(o).activeElement,i=h(o,{tabbable:u,accept:a});o.contains(b)&&(i.currentNode=b);let l=i.nextNode();return!l&&d&&(i.currentNode=o,l=i.nextNode()),l&&E(l,!0),l},focusPrevious(n=t){let o=e.current;if(!o)return null;let{from:r,tabbable:u=t.tabbable,wrap:d=t.wrap,accept:a=t.accept}=n,b=r||m(o).activeElement,i=h(o,{tabbable:u,accept:a});if(o.contains(b))i.currentNode=b;else{let c=_(i);return c&&E(c,!0),c??null}let l=i.previousNode();if(!l&&d){i.currentNode=o;let c=_(i);if(!c)return null;l=c}return l&&E(l,!0),l??null},focusFirst(n=t){let o=e.current;if(!o)return null;let{tabbable:r=t.tabbable,accept:u=t.accept}=n,a=h(o,{tabbable:r,accept:u}).nextNode();return a&&E(a,!0),a},focusLast(n=t){let o=e.current;if(!o)return null;let{tabbable:r=t.tabbable,accept:u=t.accept}=n,d=h(o,{tabbable:r,accept:u}),a=_(d);return a&&E(a,!0),a??null}}}function _(e){let t,n;do n=e.lastChild(),n&&(t=n);while(n);return t}class K{get size(){return this.fastMap.size}getTreeNode(t){return this.fastMap.get(t)}addTreeNode(t,n,o){let r=this.fastMap.get(n??null);if(!r)return;let u=new k({scopeRef:t});r.addChild(u),u.parent=r,this.fastMap.set(t,u),o&&(u.nodeToRestore=o)}addNode(t){this.fastMap.set(t.scopeRef,t)}removeTreeNode(t){if(t===null)return;let n=this.fastMap.get(t);if(!n)return;let o=n.parent;for(let u of this.traverse())u!==n&&n.nodeToRestore&&u.nodeToRestore&&n.scopeRef&&n.scopeRef.current&&T(u.nodeToRestore,n.scopeRef.current)&&(u.nodeToRestore=n.nodeToRestore);let r=n.children;o&&(o.removeChild(n),r.size>0&&r.forEach(u=>o&&o.addChild(u))),this.fastMap.delete(n.scopeRef)}*traverse(t=this.root){if(t.scopeRef!=null&&(yield t),t.children.size>0)for(let n of t.children)yield*this.traverse(n)}clone(){var t;let n=new K;var o;for(let r of this.traverse())n.addTreeNode(r.scopeRef,(o=(t=r.parent)===null||t===void 0?void 0:t.scopeRef)!==null&&o!==void 0?o:null,r.nodeToRestore);return n}constructor(){this.fastMap=new Map,this.root=new k({scopeRef:null}),this.fastMap.set(null,this.root)}}class k{addChild(t){this.children.add(t),t.parent=this}removeChild(t){this.children.delete(t),t.parent=void 0}constructor(t){this.children=new Set,this.contain=!1,this.scopeRef=t.scopeRef}}let p=new K;export{h as $,ne as a,oe as b,re as c};
