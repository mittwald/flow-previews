var x=Object.defineProperty;var D=(t,e,n)=>e in t?x(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var m=(t,e,n)=>(D(t,typeof e!="symbol"?e+"":e,n),n);import{r as p,R as a}from"./index-BwDkhjyp.js";import{b as k,o as g,c as h,N as P,P as T,A as q}from"./flowComponent-DnUs06RV.js";import{u as v}from"./useSelector-lySlwgFo.js";class b{constructor(e=!1){m(this,"isOpen");k(this,{isOpen:g,open:h.bound,close:h.bound,toggle:h.bound,setOpen:h.bound}),this.isOpen=e}static useNew(e){return p.useState(new b(e))[0]}open(){this.isOpen=!0}close(){this.isOpen=!1}toggle(){this.isOpen=!this.isOpen}setOpen(e){this.isOpen=e}useIsOpen(){return v(()=>this.isOpen)}}const O=p.createContext(void 0),L=O.Provider,I=(t={})=>{const{reuseControllerFromContext:e=!0,defaultOpen:n}=t,r=b.useNew(n),o=p.useContext(O);return e&&o?o:r},F=p.createContext(void 0),N=()=>p.useContext(F),R=F.Provider,S=t=>(...e)=>{const n=[...t],r=n.shift();if(r){const o=r(...e),s=()=>n.length===0?o:S(n)(...e);return o instanceof Promise?o.then(s):s()}},E="flowBreakActionMarker";function B(t){return!!t&&t instanceof Error&&t.message===E}const $=()=>{throw new Error(E)},A={pending:1e3,succeeded:1500,failed:2e3};class W{constructor(e,n,r={}){m(this,"options");m(this,"state");m(this,"args");m(this,"isDone",!1);m(this,"error");const{resetAfterDone:o=!0,onFeedbackDone:s=()=>{},showFeedback:i=!1}=r;this.state=e,this.args=n,this.options={resetAfterDone:o,onFeedbackDone:s,showFeedback:i}}onAsyncStart(){this.options.showFeedback=!0,this.state.updateState("isExecuting"),setTimeout(()=>this.startPending(),A.pending)}onSucceeded(){this.onDone()}onFailed(e){this.error=e??new Error("Unknown error"),console.error(e),this.onDone()}startFailedFeedback(){B(this.error)?this.resetAfterDone():(this.state.updateState("isFailed"),setTimeout(()=>this.resetAfterDone(),A.failed))}startSucceededFeedback(){this.state.updateState("isSucceeded"),setTimeout(()=>this.resetAfterDone(),A.succeeded)}resetAfterDone(){this.options.resetAfterDone&&this.state.updateState("isIdle"),this.error||this.options.onFeedbackDone(...this.args)}onDone(){this.isDone=!0,this.options.showFeedback?this.error?this.startFailedFeedback():this.startSucceededFeedback():this.resetAfterDone()}startPending(){this.isDone||this.state.updateState("isPending")}}class w{constructor(){m(this,"state","isIdle");k(this,{state:g,updateState:h})}static useNew(){return p.useRef(new w).current}updateState(e){this.state=e}useState(){return v(()=>this.state,[this])}}const _=()=>{},G=t=>{const{action:e,toggleModal:n,openModal:r,closeModal:o,break:s}=t,i=I();return e||(n?i.toggle:r?i.open:o?i.close:s?$:_)},H=(t,e={})=>{const{onSync:n=()=>{},onAsync:r=()=>{},then:o=()=>{},catch:s=()=>{},finally:i=()=>{}}=e;try{const d=t();return d instanceof Promise?(r(),d.then(o).catch(s).finally(i)):(n(),o(d),i(),d)}catch(d){n(),s(d),i()}},U=t=>{const{isConfirmationAction:e,showFeedback:n}=t,r=G(t),o=N(),s=w.useNew(),i=!e,d=e?void 0:o,y=e?o:void 0,u=S([r,d]);return{callAction:(...c)=>{const C=new W(s,c,{onFeedbackDone:y,resetAfterDone:i,showFeedback:n});return H(u,{onAsync:()=>C.onAsyncStart(),then:()=>C.onSucceeded(),catch:M=>C.onFailed(M)})},state:s}},f=t=>{const[e,n]=p.useState(!1),r=b.useNew(),o=U(t),s=e?r.open:o.callAction,y={Button:{onPress:s,render:(u,l)=>{const c=o.state.useState();return a.createElement(u,{...l,isPending:c==="isPending"?!0:void 0,"aria-disabled":c!=="isIdle"?!0:void 0,isSucceeded:c==="isSucceeded"?!0:void 0,isFailed:c==="isFailed"?!0:void 0})}},Modal:{tunnelId:"outsideActionProvider",render:(u,l)=>{const c=l.slot==="actionConfirm";return p.useEffect(()=>{if(c)return n(!0),()=>{n(!1)}},[c]),c?a.createElement(u,{controller:r,...l}):a.createElement(u,{...l})},ButtonGroup:{Button:{render:(u,l)=>{const{variant:c}=l;return c==="secondary"?a.createElement(f,{break:!0},a.createElement(f,{closeModal:!0},a.createElement(u,{...l}))):a.createElement(f,{closeModal:!0},a.createElement(f,{...t,isConfirmationAction:!0},a.createElement(u,{...l})))}}}}};return a.createElement(P,null,a.createElement(T,{props:y,dependencies:[e],mergeInParentContext:!0},a.createElement(R,{value:s},t.children),a.createElement(q,{id:"outsideActionProvider"})))};f.__docgenInfo={description:"",methods:[],displayName:"Action",props:{action:{required:!1,tsType:{name:"signature",type:"function",raw:"(...args: unknown[]) => unknown",signature:{arguments:[{type:{name:"Array",elements:[{name:"unknown"}],raw:"unknown[]"},name:"args",rest:!0}],return:{name:"unknown"}}},description:""},closeModal:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},openModal:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},toggleModal:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},break:{required:!1,tsType:{name:"boolean"},description:""},showFeedback:{required:!1,tsType:{name:"boolean"},description:""},isConfirmationAction:{required:!1,tsType:{name:"boolean"},description:"@internal"}},composes:["PropsWithChildren"]};f.__docgenInfo={description:"",methods:[],displayName:"Action",props:{action:{required:!1,tsType:{name:"signature",type:"function",raw:"(...args: unknown[]) => unknown",signature:{arguments:[{type:{name:"Array",elements:[{name:"unknown"}],raw:"unknown[]"},name:"args",rest:!0}],return:{name:"unknown"}}},description:""},closeModal:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},openModal:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},toggleModal:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},break:{required:!1,tsType:{name:"boolean"},description:""},showFeedback:{required:!1,tsType:{name:"boolean"},description:""},isConfirmationAction:{required:!1,tsType:{name:"boolean"},description:"@internal"}},composes:["PropsWithChildren"]};export{f as A,L as O,I as u};
