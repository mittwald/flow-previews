import{r as h,j as l}from"./iframe-BGRRgBVS.js";import{c as R}from"./clsx-B-dksMZM.js";import{m as N,c as j,a as g,o as $,u as G,f as b,P,v as L}from"./flowComponent-DxP1iS0K.js";import{u as _,O as U,$ as W,a as q}from"./context-BRtiiBiN.js";import{i as z}from"./browser-ClmblGlM.js";import{u as E,a as A}from"./useStatic-CZqew5Ty.js";import{d}from"./dynamic-BLodhe7F.js";const J="flow--section",K="flow--section--hide-separator",Q="flow--section--heading",C={section:J,hideSeparator:K,heading:Q},X="flow--context-menu",Y="flow--context-menu--section",Z={contextMenu:X,section:Y},tt=e=>e==="navigation"?"none":e==="switch"?"multiple":e,et=e=>e==="single"||e==="multiple"?"control":e,nt=e=>e==="multiple"||e==="switch"?void 0:"ContextMenu",w=h.createContext(void 0),ot=w.Provider,F=e=>new Promise(t=>setTimeout(t,e)),y={pending:1e3,succeeded:1500,failed:2e3};class M{showFeedback;state="isIdle";setPendingTimeout;error;isAsync=!1;constructor(){N(this,{state:$,updateState:g,isBusy:j})}static useNew(){return E(()=>new M)}updateState(t){this.state=t}useValue(){return A(()=>this.state,[this])}useIsBusy(){return A(()=>this.isBusy,[this])}get isBusy(){return this.state!=="isIdle"}onAsyncStart(){this.isAsync=!0,this.updateState("isExecuting"),this.setPendingTimeout=window.setTimeout(()=>this.startPending(),y.pending)}async onSucceeded(){await this.onDone()}async onFailed(t){this.error=t??new Error("Unknown error"),await this.onDone()}withFeedback(t){return this.showFeedback=t,this}async startFailedFeedback(){this.updateState("isFailed"),await F(y.failed),this.resetAfterDone()}async startSucceededFeedback(){this.updateState("isSucceeded"),await F(y.succeeded),this.resetAfterDone()}resetAfterDone(){this.updateState("isIdle"),this.isAsync=!1,this.error=void 0}async onDone(){this.setPendingTimeout&&window.clearTimeout(this.setPendingTimeout),this.error?await this.startFailedFeedback():this.showFeedback!==!1&&(this.showFeedback||this.isAsync)?await this.startSucceededFeedback():this.resetAfterDone()}startPending(){this.updateState("isPending")}}const D=e=>(...t)=>{const n=[...e],o=n.shift();if(o){const s=o(...t),a=()=>n.length===0?s:D(n)(...t);return s instanceof Promise?s.then(a):a()}},m=()=>{},st=(e,t={})=>{const{onSync:n=m,onAsync:o=m,then:s=m,catch:a=m,finally:c=m}=t;try{const i=e();return i instanceof Promise?(o(),i.then(s).catch(a).finally(c)):(n(),s(i),c(),i)}catch(i){n(),a(i),c()}},k=()=>{};function it(e){if(e.needsConfirmation)return e.confirmationModalController.open;const t=u=>typeof u=="string"?e.getOverlayController(u):u,{action:n,onAction:o=n,toggleOverlay:s,closeOverlay:a,openOverlay:c}=e.actionProps;return(o||(c?t(c)?.open:a?t(a)?.close:s?t(s)?.toggle:k))??k}class I{actions=[];baseAction;constructor(t){this.baseAction=t}addAction(t){this.actions.push(t)}async executeBatch(t){if(this.actions.length===0)return;const n=this.actions[this.actions.length-1]?.actionProps.showFeedback,o=this.baseAction.state.withFeedback(this.baseAction.needsConfirmation?!1:n),s=this.actions.map(i=>it(i)),a=D(s);let c;if(await st(()=>a(...t),{onAsync:()=>o.onAsyncStart(),then:()=>o.onSucceeded(),catch:i=>{o.onFailed(i),c=i}}),c)throw c}}class at{action;constructor(t){this.action=t}execute=(...t)=>{const n=this.getBatchedActions();(async()=>{for(const s of n)await s.executeBatch(t)})().catch(s=>console.error(s))};getBatchedActions=()=>{let t=this.action;const n=[];let o=new I(this.action),s=0;for(;t;){const{action:a,break:c,skip:i}=t.actionProps;if(t.needsConfirmation){o.addAction(t);break}if(i){s=i===!0?1:i,t=t.parentAction;continue}if(s>0){t=t.parentAction,s--;continue}if(c)break;a||(n.push(o),o=new I(this.action)),o.addAction(t),t=t.parentAction}return n.push(o),n}}class p{states=new Set;constructor(){N(this,{states:$,addState:g,removeState:g,isBusy:j})}static useNew(){return E(()=>new p)}static useRegisterState(t){const n=T();h.useEffect(()=>(n?.addState(t),()=>{n?.removeState(t)}),[n,t])}addState(t){this.states.add(t)}removeState(t){this.states.delete(t)}useIsBusy(){return A(()=>this.isBusy)}get isBusy(){for(const t of this.states)if(t.isBusy)return!0;return!1}}const V=h.createContext(void 0),ct=e=>{const{children:t}=e,n=p.useNew();return l.jsx(V.Provider,{value:n,children:t})},T=()=>{const e=p.useNew();return h.useContext(V)??e};ct.__docgenInfo={description:"",methods:[],displayName:"ActionStateContextProvider"};class r{state;needsConfirmation;actionProps;parentAction;confirmationModalController;overlayContext;constructor(t){const{actionProps:n,needsConfirmation:o,parentAction:s,overlayContext:a,confirmationModalController:c,state:i}=t;this.actionProps=n,this.parentAction=s,this.confirmationModalController=c,this.needsConfirmation=o,this.overlayContext=a,this.state=i}static useNew(t,n={}){const o=h.useContext(w),s=_(),a=U.useNew(),c=M.useNew();return new r({parentAction:o,overlayContext:s,confirmationModalController:a,needsConfirmation:!1,actionProps:t,state:c,...n})}static use(){const t=h.useContext(w);return z(!!t,"Action context is not defined"),p.useRegisterState(t.state),t}static useConfirmationAction(){const t=r.use();return new r({actionProps:t.actionProps,confirmationModalController:t.confirmationModalController,overlayContext:t.overlayContext,state:t.state,needsConfirmation:!1,parentAction:r.useNew({closeOverlay:t.confirmationModalController},{parentAction:t.parentAction})})}getOverlayController(t){const n=o=>o===void 0?void 0:o?this.overlayContext[t]:void 0;return n(this.actionProps.openOverlay)??n(this.actionProps.closeOverlay)??n(this.actionProps.toggleOverlay)}execute=(...t)=>{new at(this).execute(...t)}}const rt=e=>G()[e],lt=e=>{const{slot:t,...n}=e,o=n.color===void 0||n.color==="primary"||n.color==="danger"||n.color==="accent"?"primary":"abort";return t??o},v=e=>rt("Modal")==="actionConfirm"?lt(e):void 0,x=e=>{const t=r.use(),n=t.state.useValue(),o=v(e)==="primary",s=t.confirmationModalController.useIsOpen();return t.needsConfirmation&&s&&!o?"isIdle":n},S={onPress:d(e=>{const t=r.use(),n=r.useConfirmationAction(),o=v(e)==="primary";return v(e)==="abort"?t.confirmationModalController.close:o?n.execute:t.execute}),isPending:d(e=>{const t=x(e);return e.isPending??t==="isPending"}),isSucceeded:d(e=>{const t=x(e);return e.isSucceeded??t==="isSucceeded"}),isFailed:d(e=>{const t=x(e);return e.isFailed??t==="isFailed"}),"aria-disabled":d(e=>{const t=x(e),n=T().useIsBusy();return e["aria-disabled"]??(t==="isExecuting"||n)})},O=b("Action",e=>{const{children:t,actionModel:n,...o}=e,s=r.useNew(o),a=n??s,c={Button:S,SubmitButton:S,Link:{onPress:d(()=>r.use().execute)},MenuItem:{onAction:d(()=>r.use().execute)},Modal:{slot:d(i=>{const{slot:u}=i,f=r.use();return f.needsConfirmation=u==="actionConfirm",u}),isDismissable:d(i=>{const f=r.use().state.useValue();return f==="isExecuting"||f==="isPending"?!1:i.isDismissable}),controller:d(()=>{const i=r.use();return i.needsConfirmation?i.confirmationModalController:i.getOverlayController("Modal")}),ActionGroup:{Button:S}}};return l.jsx(ot,{value:a,children:l.jsx(P,{props:c,children:t})})},{type:"provider"}),H=b("ContextMenuSection",e=>{const{children:t,selectionMode:n,ref:o,...s}=e,a=et(n),c={Heading:{level:5,wrapWith:l.jsx(q,{})},MenuItem:{selectionVariant:a}};return l.jsx(W,{ref:o,...s,selectionMode:tt(n),className:Z.section,children:l.jsx(P,{props:c,children:l.jsx(O,{skip:!0,children:l.jsx(O,{closeOverlay:nt(n),children:t})})})})});H.__docgenInfo={description:"@flr-generate all",methods:[],displayName:"ContextMenuSection"};const B=h.memo(e=>{const t=h.useContext(L).ContextMenuSection??H;return l.jsx(t,{...e})});B.displayName="ContextMenuSectionView";B.__docgenInfo={description:"",methods:[],displayName:"ContextMenuSectionView"};const ut=b("Section",e=>{const{children:t,className:n,ref:o,renderContextMenuSection:s,hideSeparator:a,...c}=e;if(!t)return null;if(s)return l.jsx(B,{ref:o,children:t});const i=R(C.section,n,a&&C.hideSeparator),u=h.useId(),f={Heading:{level:2,id:u,className:C.heading},Header:{renderSectionHeader:!0},List:{"aria-labelledby":u}};return l.jsx("section",{...c,className:i,ref:o,children:l.jsx(P,{props:f,children:t})})});ut.__docgenInfo={description:"@flr-generate all",methods:[],displayName:"Section"};export{O as A,B as C,ut as S,Z as a,et as b,nt as c,ct as d,lt as e,r as f,tt as g,H as h,F as s};
