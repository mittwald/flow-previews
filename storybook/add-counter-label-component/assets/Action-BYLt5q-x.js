var M=Object.defineProperty;var T=(t,e,n)=>e in t?M(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var m=(t,e,n)=>(T(t,typeof e!="symbol"?e+"":e,n),n);import{r as f,R as i}from"./index-uCp2LrAq.js";import{p as I,b as k,o as g,c as y,d as R,N as q,P as N,A as B}from"./flowComponent-CNW7-kvN.js";import{u as w}from"./useSelector-CNSXmums.js";function $(){return I(Object.values,arguments)}class v{constructor(e=!1){m(this,"isOpen");k(this,{isOpen:g,open:y.bound,close:y.bound,toggle:y.bound,setOpen:y.bound}),this.isOpen=e}static useNew(e){return f.useState(new v(e))[0]}open(){this.isOpen=!0}close(){this.isOpen=!1}toggle(){this.isOpen=!this.isOpen}setOpen(e){this.isOpen=e}useIsOpen(){return w(()=>this.isOpen)}}const F=f.createContext(void 0),_=F.Provider,j=(t={})=>{const{reuseControllerFromContext:e=!0,defaultOpen:n}=t,r=v.useNew(n),o=f.useContext(F);return e&&o?o:r},S=f.createContext(void 0),G=()=>f.useContext(S),H=S.Provider,E=t=>(...e)=>{const n=[...t],r=n.shift();if(r){const o=r(...e),s=()=>n.length===0?o:E(n)(...e);return o instanceof Promise?o.then(s):s()}},x="flowBreakActionMarker";function L(t){return!!t&&t instanceof Error&&t.message===x}const U=()=>{throw new Error(x)},C={pending:1e3,succeeded:1500,failed:2e3};class W{constructor(e,n,r={}){m(this,"options");m(this,"state");m(this,"args");m(this,"isDone",!1);m(this,"error");const{resetAfterDone:o=!0,onFeedbackDone:s=()=>{},showFeedback:u=!1}=r;this.state=e,this.args=n,this.options={resetAfterDone:o,onFeedbackDone:s,showFeedback:u}}onAsyncStart(){this.options.showFeedback=!0,this.state.updateState("isExecuting"),setTimeout(()=>this.startPending(),C.pending)}onSucceeded(){this.onDone()}onFailed(e){this.error=e??new Error("Unknown error"),console.error(e),this.onDone()}startFailedFeedback(){L(this.error)?this.resetAfterDone():(this.state.updateState("isFailed"),setTimeout(()=>this.resetAfterDone(),C.failed))}startSucceededFeedback(){this.state.updateState("isSucceeded"),setTimeout(()=>this.resetAfterDone(),C.succeeded)}resetAfterDone(){this.options.resetAfterDone&&this.state.updateState("isIdle"),this.error||this.options.onFeedbackDone(...this.args)}onDone(){this.isDone=!0,this.options.showFeedback?this.error?this.startFailedFeedback():this.startSucceededFeedback():this.resetAfterDone()}startPending(){this.isDone||this.state.updateState("isPending")}}class O{constructor(){m(this,"state","isIdle");k(this,{state:g,updateState:y})}static useNew(){return f.useRef(new O).current}updateState(e){this.state=e}useState(){return w(()=>this.state,[this])}}const z=()=>{},J=t=>{const{action:e,toggleOverlay:n,openOverlay:r,closeOverlay:o,break:s}=t,u=j(),a=p=>typeof p=="boolean"?u:p;return e||(n?a(n).toggle:r?a(r).open:o?a(o).close:s?U:z)},h=()=>{},K=(t,e={})=>{const{onSync:n=h,onAsync:r=h,then:o=h,catch:s=h,finally:u=h}=e;try{const a=t();return a instanceof Promise?(r(),a.then(o).catch(s).finally(u)):(n(),o(a),u(),a)}catch(a){n(),s(a),u()}},Q=t=>{const{isConfirmationAction:e,showFeedback:n}=t,r=J(t),o=G(),s=O.useNew(),u=!e,a=e?void 0:o,p=e?o:void 0,d=E([r,a]),l=(...D)=>{const A=new W(s,D,{onFeedbackDone:p,resetAfterDone:u,showFeedback:n});return K(d,{onAsync:()=>A.onAsyncStart(),then:()=>A.onSucceeded(),catch:P=>A.onFailed(P)})},c=$(R(t,["children"]));return f.useMemo(()=>({callAction:l,state:s}),c)},b=t=>{const[e,n]=f.useState(!1),r=v.useNew(),o=Q(t),s=e?r.open:o.callAction,p={Link:{onPress:s},Button:{onPress:s,render:(d,l)=>{const c=o.state.useState();return i.createElement(d,{...l,isPending:c==="isPending"?!0:void 0,"aria-disabled":c!=="isIdle"?!0:void 0,isSucceeded:c==="isSucceeded"?!0:void 0,isFailed:c==="isFailed"?!0:void 0})}},Modal:{tunnelId:"outsideActionProvider",render:(d,l)=>{const c=l.slot==="actionConfirm";return f.useEffect(()=>{if(c)return n(!0),()=>{n(!1)}},[c]),c?i.createElement(d,{controller:r,...l}):i.createElement(d,{...l})},ButtonGroup:{Button:{render:(d,l)=>{const{color:c}=l;return c==="secondary"?i.createElement(b,{break:!0},i.createElement(b,{closeOverlay:!0},i.createElement(d,{...l}))):i.createElement(b,{closeOverlay:!0},i.createElement(b,{...t,isConfirmationAction:!0},i.createElement(d,{...l})))}}}}};return i.createElement(q,null,i.createElement(N,{props:p,dependencies:[e,o],mergeInParentContext:!0},i.createElement(H,{value:s},t.children),i.createElement(B,{id:"outsideActionProvider"})))};b.__docgenInfo={description:"",methods:[],displayName:"Action",props:{action:{required:!1,tsType:{name:"signature",type:"function",raw:"(...args: unknown[]) => unknown",signature:{arguments:[{type:{name:"Array",elements:[{name:"unknown"}],raw:"unknown[]"},name:"args",rest:!0}],return:{name:"unknown"}}},description:""},closeOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},openOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},toggleOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},break:{required:!1,tsType:{name:"boolean"},description:""},showFeedback:{required:!1,tsType:{name:"boolean"},description:""},isConfirmationAction:{required:!1,tsType:{name:"boolean"},description:"@internal"}},composes:["PropsWithChildren"]};export{b as A,_ as O,j as u};
