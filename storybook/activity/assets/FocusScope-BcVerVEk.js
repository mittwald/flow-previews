import{d as D,e as N,f as I}from"./useFocusable-DzpyvdoN.js";import{e as h}from"./flowComponent-DSjr-DA9.js";import{r as m,R as x}from"./index-BwDkhjyp.js";function V(e){const t=D(e);if(!(e instanceof t.HTMLElement)&&!(e instanceof t.SVGElement))return!1;let{display:r,visibility:o}=e.style,n=r!=="none"&&o!=="hidden"&&o!=="collapse";if(n){const{getComputedStyle:i}=e.ownerDocument.defaultView;let{display:u,visibility:a}=i(e);n=u!=="none"&&a!=="hidden"&&a!=="collapse"}return n}function B(e,t){return!e.hasAttribute("hidden")&&!e.hasAttribute("data-react-aria-prevent-focus")&&(e.nodeName==="DETAILS"&&t&&t.nodeName!=="SUMMARY"?e.hasAttribute("open"):!0)}function k(e,t){return e.nodeName!=="#comment"&&V(e)&&B(e,t)&&(!e.parentElement||k(e.parentElement,e))}const A=x.createContext(null);let s=null;function Q(e){let{children:t,contain:r,restoreFocus:o,autoFocus:n}=e,i=m.useRef(null),u=m.useRef(null),a=m.useRef([]),{parentNode:p}=m.useContext(A)||{},l=m.useMemo(()=>new _({scopeRef:a}),[a]);h(()=>{let v=p||b.root;if(b.getTreeNode(v.scopeRef)&&s&&!L(s,v.scopeRef)){let f=b.getTreeNode(s);f&&(v=f)}v.addChild(l),b.addNode(l)},[l,p]),h(()=>{let v=b.getTreeNode(a);v&&(v.contain=!!r)},[r]),h(()=>{var v;let f=(v=i.current)===null||v===void 0?void 0:v.nextSibling,E=[];for(;f&&f!==u.current;)E.push(f),f=f.nextSibling;a.current=E},[t]),H(a,o,r),z(a,r),W(a,o,r),q(a,n),m.useEffect(()=>{const v=N(a.current?a.current[0]:void 0).activeElement;let f=null;if($(v,a.current)){for(let E of b.traverse())E.scopeRef&&$(v,E.scopeRef.current)&&(f=E);f===b.getTreeNode(a)&&(s=f.scopeRef)}},[a]),h(()=>()=>{var v,f,E;let F=(E=(f=b.getTreeNode(a))===null||f===void 0||(v=f.parent)===null||v===void 0?void 0:v.scopeRef)!==null&&E!==void 0?E:null;(a===s||L(a,s))&&(!F||b.getTreeNode(F))&&(s=F),b.removeTreeNode(a)},[a]);let d=m.useMemo(()=>O(a),[]),c=m.useMemo(()=>({focusManager:d,parentNode:l}),[l,d]);return x.createElement(A.Provider,{value:c},x.createElement("span",{"data-focus-scope-start":!0,hidden:!0,ref:i}),t,x.createElement("span",{"data-focus-scope-end":!0,hidden:!0,ref:u}))}function O(e){return{focusNext(t={}){let r=e.current,{from:o,tabbable:n,wrap:i,accept:u}=t,a=o||N(r[0]).activeElement,p=r[0].previousElementSibling,l=y(r),d=g(l,{tabbable:n,accept:u},r);d.currentNode=$(a,r)?a:p;let c=d.nextNode();return!c&&i&&(d.currentNode=p,c=d.nextNode()),c&&T(c,!0),c},focusPrevious(t={}){let r=e.current,{from:o,tabbable:n,wrap:i,accept:u}=t,a=o||N(r[0]).activeElement,p=r[r.length-1].nextElementSibling,l=y(r),d=g(l,{tabbable:n,accept:u},r);d.currentNode=$(a,r)?a:p;let c=d.previousNode();return!c&&i&&(d.currentNode=p,c=d.previousNode()),c&&T(c,!0),c},focusFirst(t={}){let r=e.current,{tabbable:o,accept:n}=t,i=y(r),u=g(i,{tabbable:o,accept:n},r);u.currentNode=r[0].previousElementSibling;let a=u.nextNode();return a&&T(a,!0),a},focusLast(t={}){let r=e.current,{tabbable:o,accept:n}=t,i=y(r),u=g(i,{tabbable:o,accept:n},r);u.currentNode=r[r.length-1].nextElementSibling;let a=u.previousNode();return a&&T(a,!0),a}}}const C=["input:not([disabled]):not([type=hidden])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[contenteditable]"],P=C.join(":not([hidden]),")+",[tabindex]:not([disabled]):not([hidden])";C.push('[tabindex]:not([tabindex="-1"]):not([disabled])');const j=C.join(':not([hidden]):not([tabindex="-1"]),');function y(e){return e[0].parentElement}function w(e){let t=b.getTreeNode(s);for(;t&&t.scopeRef!==e;){if(t.contain)return!1;t=t.parent}return!0}function z(e,t){let r=m.useRef(),o=m.useRef();h(()=>{let n=e.current;if(!t){o.current&&(cancelAnimationFrame(o.current),o.current=void 0);return}const i=N(n?n[0]:void 0);let u=l=>{if(l.key!=="Tab"||l.altKey||l.ctrlKey||l.metaKey||!w(e)||l.isComposing)return;let d=i.activeElement,c=e.current;if(!c||!$(d,c))return;let v=y(c),f=g(v,{tabbable:!0},c);if(!d)return;f.currentNode=d;let E=l.shiftKey?f.previousNode():f.nextNode();E||(f.currentNode=l.shiftKey?c[c.length-1].nextElementSibling:c[0].previousElementSibling,E=l.shiftKey?f.previousNode():f.nextNode()),l.preventDefault(),E&&T(E,!0)},a=l=>{(!s||L(s,e))&&$(l.target,e.current)?(s=e,r.current=l.target):w(e)&&!S(l.target,e)?r.current?r.current.focus():s&&s.current&&R(s.current):w(e)&&(r.current=l.target)},p=l=>{o.current&&cancelAnimationFrame(o.current),o.current=requestAnimationFrame(()=>{if(i.activeElement&&w(e)&&!S(i.activeElement,e))if(s=e,i.body.contains(l.target)){var d;r.current=l.target,(d=r.current)===null||d===void 0||d.focus()}else s.current&&R(s.current)})};return i.addEventListener("keydown",u,!1),i.addEventListener("focusin",a,!1),n==null||n.forEach(l=>l.addEventListener("focusin",a,!1)),n==null||n.forEach(l=>l.addEventListener("focusout",p,!1)),()=>{i.removeEventListener("keydown",u,!1),i.removeEventListener("focusin",a,!1),n==null||n.forEach(l=>l.removeEventListener("focusin",a,!1)),n==null||n.forEach(l=>l.removeEventListener("focusout",p,!1))}},[e,t]),h(()=>()=>{o.current&&cancelAnimationFrame(o.current)},[o])}function K(e){return S(e)}function $(e,t){return!e||!t?!1:t.some(r=>r.contains(e))}function S(e,t=null){if(e instanceof Element&&e.closest("[data-react-aria-top-layer]"))return!0;for(let{scopeRef:r}of b.traverse(b.getTreeNode(t)))if(r&&$(e,r.current))return!0;return!1}function X(e){return S(e,s)}function L(e,t){var r;let o=(r=b.getTreeNode(t))===null||r===void 0?void 0:r.parent;for(;o;){if(o.scopeRef===e)return!0;o=o.parent}return!1}function T(e,t=!1){if(e!=null&&!t)try{I(e)}catch{}else if(e!=null)try{e.focus()}catch{}}function R(e,t=!0){let r=e[0].previousElementSibling,o=y(e),n=g(o,{tabbable:t},e);n.currentNode=r;let i=n.nextNode();t&&!i&&(o=y(e),n=g(o,{tabbable:!1},e),n.currentNode=r,i=n.nextNode()),T(i)}function q(e,t){const r=x.useRef(t);m.useEffect(()=>{if(r.current){s=e;const o=N(e.current?e.current[0]:void 0);!$(o.activeElement,s.current)&&e.current&&R(e.current)}r.current=!1},[e])}function H(e,t,r){h(()=>{if(t||r)return;let o=e.current;const n=N(o?o[0]:void 0);let i=u=>{let a=u.target;$(a,e.current)?s=e:K(a)||(s=null)};return n.addEventListener("focusin",i,!1),o==null||o.forEach(u=>u.addEventListener("focusin",i,!1)),()=>{n.removeEventListener("focusin",i,!1),o==null||o.forEach(u=>u.removeEventListener("focusin",i,!1))}},[e,t,r])}function U(e){let t=b.getTreeNode(s);for(;t&&t.scopeRef!==e;){if(t.nodeToRestore)return!1;t=t.parent}return(t==null?void 0:t.scopeRef)===e}function W(e,t,r){const o=m.useRef(typeof document<"u"?N(e.current?e.current[0]:void 0).activeElement:null);h(()=>{let n=e.current;const i=N(n?n[0]:void 0);if(!t||r)return;let u=()=>{(!s||L(s,e))&&$(i.activeElement,e.current)&&(s=e)};return i.addEventListener("focusin",u,!1),n==null||n.forEach(a=>a.addEventListener("focusin",u,!1)),()=>{i.removeEventListener("focusin",u,!1),n==null||n.forEach(a=>a.removeEventListener("focusin",u,!1))}},[e,r]),h(()=>{const n=N(e.current?e.current[0]:void 0);if(!t)return;let i=u=>{if(u.key!=="Tab"||u.altKey||u.ctrlKey||u.metaKey||!w(e)||u.isComposing)return;let a=n.activeElement;if(!$(a,e.current))return;let p=b.getTreeNode(e);if(!p)return;let l=p.nodeToRestore,d=g(n.body,{tabbable:!0});d.currentNode=a;let c=u.shiftKey?d.previousNode():d.nextNode();if((!l||!n.body.contains(l)||l===n.body)&&(l=void 0,p.nodeToRestore=void 0),(!c||!$(c,e.current))&&l){d.currentNode=l;do c=u.shiftKey?d.previousNode():d.nextNode();while($(c,e.current));u.preventDefault(),u.stopPropagation(),c?T(c,!0):K(l)?T(l,!0):a.blur()}};return r||n.addEventListener("keydown",i,!0),()=>{r||n.removeEventListener("keydown",i,!0)}},[e,t,r]),h(()=>{const n=N(e.current?e.current[0]:void 0);if(!t)return;let i=b.getTreeNode(e);if(i){var u;return i.nodeToRestore=(u=o.current)!==null&&u!==void 0?u:void 0,()=>{let a=b.getTreeNode(e);if(!a)return;let p=a.nodeToRestore;if(t&&p&&($(n.activeElement,e.current)||n.activeElement===n.body&&U(e))){let l=b.clone();requestAnimationFrame(()=>{if(n.activeElement===n.body){let d=l.getTreeNode(e);for(;d;){if(d.nodeToRestore&&d.nodeToRestore.isConnected){T(d.nodeToRestore);return}d=d.parent}for(d=l.getTreeNode(e);d;){if(d.scopeRef&&d.scopeRef.current&&b.getTreeNode(d.scopeRef)){R(d.scopeRef.current,!0);return}d=d.parent}}})}}}},[e,t])}function g(e,t,r){let o=t!=null&&t.tabbable?j:P,n=N(e).createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode(i){var u;return!(t==null||(u=t.from)===null||u===void 0)&&u.contains(i)?NodeFilter.FILTER_REJECT:i.matches(o)&&k(i)&&(!r||$(i,r))&&(!(t!=null&&t.accept)||t.accept(i))?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});return t!=null&&t.from&&(n.currentNode=t.from),n}class M{get size(){return this.fastMap.size}getTreeNode(t){return this.fastMap.get(t)}addTreeNode(t,r,o){let n=this.fastMap.get(r??null);if(!n)return;let i=new _({scopeRef:t});n.addChild(i),i.parent=n,this.fastMap.set(t,i),o&&(i.nodeToRestore=o)}addNode(t){this.fastMap.set(t.scopeRef,t)}removeTreeNode(t){if(t===null)return;let r=this.fastMap.get(t);if(!r)return;let o=r.parent;for(let i of this.traverse())i!==r&&r.nodeToRestore&&i.nodeToRestore&&r.scopeRef&&r.scopeRef.current&&$(i.nodeToRestore,r.scopeRef.current)&&(i.nodeToRestore=r.nodeToRestore);let n=r.children;o&&(o.removeChild(r),n.size>0&&n.forEach(i=>o&&o.addChild(i))),this.fastMap.delete(r.scopeRef)}*traverse(t=this.root){if(t.scopeRef!=null&&(yield t),t.children.size>0)for(let r of t.children)yield*this.traverse(r)}clone(){var t;let r=new M;var o;for(let n of this.traverse())r.addTreeNode(n.scopeRef,(o=(t=n.parent)===null||t===void 0?void 0:t.scopeRef)!==null&&o!==void 0?o:null,n.nodeToRestore);return r}constructor(){this.fastMap=new Map,this.root=new _({scopeRef:null}),this.fastMap.set(null,this.root)}}class _{addChild(t){this.children.add(t),t.parent=this}removeChild(t){this.children.delete(t),t.parent=void 0}constructor(t){this.children=new Set,this.contain=!1,this.scopeRef=t.scopeRef}}let b=new M;export{g as $,Q as a,X as b};
