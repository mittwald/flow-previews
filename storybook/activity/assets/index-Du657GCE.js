var D=Object.defineProperty;var T=(t,e,n)=>e in t?D(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var m=(t,e,n)=>(T(t,typeof e!="symbol"?e+"":e,n),n);import{r as p,R as i}from"./index-uCp2LrAq.js";import{m as w,o as k,i as b,N as q,P as M,A as I}from"./flowComponent-CvYijzQN.js";import{u as g}from"./useSelector-BUdyqjrG.js";class v{constructor(e=!1){m(this,"isOpen");w(this,{isOpen:k,open:b.bound,close:b.bound,toggle:b.bound,setOpen:b.bound}),this.isOpen=e}static useNew(e){return p.useState(new v(e))[0]}open(){this.isOpen=!0}close(){this.isOpen=!1}toggle(){this.isOpen=!this.isOpen}setOpen(e){this.isOpen=e}useIsOpen(){return g(()=>this.isOpen)}}const F=p.createContext(void 0),Q=F.Provider,N=(t={})=>{const{reuseControllerFromContext:e=!0,defaultOpen:n}=t,r=v.useNew(n),o=p.useContext(F);return e&&o?o:r},S=p.createContext(void 0),R=()=>p.useContext(S),B=S.Provider,E=t=>(...e)=>{const n=[...t],r=n.shift();if(r){const o=r(...e),s=()=>n.length===0?o:E(n)(...e);return o instanceof Promise?o.then(s):s()}},x="flowBreakActionMarker";function $(t){return!!t&&t instanceof Error&&t.message===x}const W=()=>{throw new Error(x)},A={pending:1e3,succeeded:1500,failed:2e3};class _{constructor(e,n,r={}){m(this,"options");m(this,"state");m(this,"args");m(this,"isDone",!1);m(this,"error");const{resetAfterDone:o=!0,onFeedbackDone:s=()=>{},showFeedback:l=!1}=r;this.state=e,this.args=n,this.options={resetAfterDone:o,onFeedbackDone:s,showFeedback:l}}onAsyncStart(){this.options.showFeedback=!0,this.state.updateState("isExecuting"),setTimeout(()=>this.startPending(),A.pending)}onSucceeded(){this.onDone()}onFailed(e){this.error=e??new Error("Unknown error"),console.error(e),this.onDone()}startFailedFeedback(){$(this.error)?this.resetAfterDone():(this.state.updateState("isFailed"),setTimeout(()=>this.resetAfterDone(),A.failed))}startSucceededFeedback(){this.state.updateState("isSucceeded"),setTimeout(()=>this.resetAfterDone(),A.succeeded)}resetAfterDone(){this.options.resetAfterDone&&this.state.updateState("isIdle"),this.error||this.options.onFeedbackDone(...this.args)}onDone(){this.isDone=!0,this.options.showFeedback?this.error?this.startFailedFeedback():this.startSucceededFeedback():this.resetAfterDone()}startPending(){this.isDone||this.state.updateState("isPending")}}class O{constructor(){m(this,"state","isIdle");w(this,{state:k,updateState:b})}static useNew(){return p.useRef(new O).current}updateState(e){this.state=e}useState(){return g(()=>this.state,[this])}}const G=()=>{},H=t=>{const{action:e,toggleOverlay:n,openOverlay:r,closeOverlay:o,break:s}=t,l=N(),a=f=>typeof f=="boolean"?l:f;return e||(n?a(n).toggle:r?a(r).open:o?a(o).close:s?W:G)},y=()=>{},L=(t,e={})=>{const{onSync:n=y,onAsync:r=y,then:o=y,catch:s=y,finally:l=y}=e;try{const a=t();return a instanceof Promise?(r(),a.then(o).catch(s).finally(l)):(n(),o(a),l(),a)}catch(a){n(),s(a),l()}},U=t=>{const{isConfirmationAction:e,showFeedback:n}=t,r=H(t),o=R(),s=O.useNew(),l=!e,a=e?void 0:o,f=e?o:void 0,d=E([r,a]);return{callAction:(...c)=>{const C=new _(s,c,{onFeedbackDone:f,resetAfterDone:l,showFeedback:n});return L(d,{onAsync:()=>C.onAsyncStart(),then:()=>C.onSucceeded(),catch:P=>C.onFailed(P)})},state:s}},h=t=>{const[e,n]=p.useState(!1),r=v.useNew(),o=U(t),s=e?r.open:o.callAction,f={Link:{onPress:s},Button:{onPress:s,render:(d,u)=>{const c=o.state.useState();return i.createElement(d,{...u,isPending:c==="isPending"?!0:void 0,"aria-disabled":c!=="isIdle"?!0:void 0,isSucceeded:c==="isSucceeded"?!0:void 0,isFailed:c==="isFailed"?!0:void 0})}},Modal:{tunnelId:"outsideActionProvider",render:(d,u)=>{const c=u.slot==="actionConfirm";return p.useEffect(()=>{if(c)return n(!0),()=>{n(!1)}},[c]),c?i.createElement(d,{controller:r,...u}):i.createElement(d,{...u})},ButtonGroup:{Button:{render:(d,u)=>{const{color:c}=u;return c==="secondary"?i.createElement(h,{break:!0},i.createElement(h,{closeOverlay:!0},i.createElement(d,{...u}))):i.createElement(h,{closeOverlay:!0},i.createElement(h,{...t,isConfirmationAction:!0},i.createElement(d,{...u})))}}}}};return i.createElement(q,null,i.createElement(M,{props:f,dependencies:[e],mergeInParentContext:!0},i.createElement(B,{value:s},t.children),i.createElement(I,{id:"outsideActionProvider"})))};h.__docgenInfo={description:"",methods:[],displayName:"Action",props:{action:{required:!1,tsType:{name:"signature",type:"function",raw:"(...args: unknown[]) => unknown",signature:{arguments:[{type:{name:"Array",elements:[{name:"unknown"}],raw:"unknown[]"},name:"args",rest:!0}],return:{name:"unknown"}}},description:""},closeOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},openOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},toggleOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},break:{required:!1,tsType:{name:"boolean"},description:""},showFeedback:{required:!1,tsType:{name:"boolean"},description:""},isConfirmationAction:{required:!1,tsType:{name:"boolean"},description:"@internal"}},composes:["PropsWithChildren"]};h.__docgenInfo={description:"",methods:[],displayName:"Action",props:{action:{required:!1,tsType:{name:"signature",type:"function",raw:"(...args: unknown[]) => unknown",signature:{arguments:[{type:{name:"Array",elements:[{name:"unknown"}],raw:"unknown[]"},name:"args",rest:!0}],return:{name:"unknown"}}},description:""},closeOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},openOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},toggleOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},break:{required:!1,tsType:{name:"boolean"},description:""},showFeedback:{required:!1,tsType:{name:"boolean"},description:""},isConfirmationAction:{required:!1,tsType:{name:"boolean"},description:"@internal"}},composes:["PropsWithChildren"]};export{h as A,Q as O,N as u};
