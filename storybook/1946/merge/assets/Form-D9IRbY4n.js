import{r as c}from"./iframe-r9Fl_3r-.js";import{D as O}from"./useFocus-DRS9ufOF.js";import{b as T,c as I,g as D,$ as U}from"./mergeRefs-D6E7Ef6S.js";import{a as j}from"./useLabel-DoVt-K4x.js";const x={badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1,valid:!0},P={...x,customError:!0,valid:!1},m={isInvalid:!1,validationDetails:x,validationErrors:[]},F=c.createContext({}),L="__formValidationState"+Date.now();function X(t){if(t[L]){let{realtimeValidation:e,displayValidation:a,updateValidation:r,resetValidation:v,commitValidation:l}=t[L];return{realtimeValidation:e,displayValidation:a,updateValidation:r,resetValidation:v,commitValidation:l}}return Q(t)}function Q(t){let{isInvalid:e,validationState:a,name:r,value:v,builtinValidation:l,validate:o,validationBehavior:n="aria"}=t;a&&(e||(e=a==="invalid"));let u=e!==void 0?{isInvalid:e,validationErrors:[],validationDetails:P}:null,d=c.useMemo(()=>{if(!o||v==null)return null;let s=k(o,v);return C(s)},[o,v]);l!=null&&l.validationDetails.valid&&(l=void 0);let i=c.useContext(F),f=c.useMemo(()=>r?Array.isArray(r)?r.flatMap(s=>h(i[s])):h(i[r]):[],[i,r]),[$,B]=c.useState(i),[S,p]=c.useState(!1);i!==$&&(B(i),p(!1));let V=c.useMemo(()=>C(S?[]:f),[S,f]),w=c.useRef(m),[g,E]=c.useState(m),b=c.useRef(m),A=()=>{if(!R)return;y(!1);let s=d||l||w.current;M(s,b.current)||(b.current=s,E(s))},[R,y]=c.useState(!1);return c.useEffect(A),{realtimeValidation:u||V||d||l||m,displayValidation:n==="native"?u||V||g:u||V||d||l||g,updateValidation(s){n==="aria"&&!M(g,s)?E(s):w.current=s},resetValidation(){let s=m;M(s,b.current)||(b.current=s,E(s)),n==="native"&&y(!1),p(!0)},commitValidation(){n==="native"&&y(!0),p(!0)}}}function h(t){return t?Array.isArray(t)?t:[t]:[]}function k(t,e){if(typeof t=="function"){let a=t(e);if(a&&typeof a!="boolean")return h(a)}return[]}function C(t){return t.length?{isInvalid:!0,validationErrors:t,validationDetails:P}:null}function M(t,e){return t===e?!0:!!t&&!!e&&t.isInvalid===e.isInvalid&&t.validationErrors.length===e.validationErrors.length&&t.validationErrors.every((a,r)=>a===e.validationErrors[r])&&Object.entries(t.validationDetails).every(([a,r])=>e.validationDetails[a]===r)}function Z(...t){let e=new Set,a=!1,r={...x};for(let o of t){var v,l;for(let n of o.validationErrors)e.add(n);a||(a=o.isInvalid);for(let n in r)(v=r)[l=n]||(v[l]=o.validationDetails[n])}return r.valid=!a,{isInvalid:a,validationErrors:[...e],validationDetails:r}}function _(t,e,a){let{validationBehavior:r,focus:v}=t;T(()=>{if(r==="native"&&(a!=null&&a.current)&&!a.current.disabled){let d=e.realtimeValidation.isInvalid?e.realtimeValidation.validationErrors.join(" ")||"Invalid value.":"";a.current.setCustomValidity(d),a.current.hasAttribute("title")||(a.current.title=""),e.realtimeValidation.isInvalid||e.updateValidation(N(a.current))}});let l=c.useRef(!1),o=I(()=>{l.current||e.resetValidation()}),n=I(d=>{var i;e.displayValidation.isInvalid||e.commitValidation();let f=a==null||(i=a.current)===null||i===void 0?void 0:i.form;if(!d.defaultPrevented&&a&&f&&Y(f)===a.current){var $;v?v():($=a.current)===null||$===void 0||$.focus(),O("keyboard")}d.preventDefault()}),u=I(()=>{e.commitValidation()});c.useEffect(()=>{let d=a==null?void 0:a.current;if(!d)return;let i=d.form,f=i==null?void 0:i.reset;return i&&(i.reset=()=>{l.current=!window.event||window.event.type==="message"&&window.event.target instanceof MessagePort,f==null||f.call(i),l.current=!1}),d.addEventListener("invalid",n),d.addEventListener("change",u),i==null||i.addEventListener("reset",o),()=>{d.removeEventListener("invalid",n),d.removeEventListener("change",u),i==null||i.removeEventListener("reset",o),i&&(i.reset=f)}},[a,n,u,o,r])}function q(t){let e=t.validity;return{badInput:e.badInput,customError:e.customError,patternMismatch:e.patternMismatch,rangeOverflow:e.rangeOverflow,rangeUnderflow:e.rangeUnderflow,stepMismatch:e.stepMismatch,tooLong:e.tooLong,tooShort:e.tooShort,typeMismatch:e.typeMismatch,valueMissing:e.valueMissing,valid:e.valid}}function N(t){return{isInvalid:!t.validity.valid,validationDetails:q(t),validationErrors:t.validationMessage?[t.validationMessage]:[]}}function Y(t){for(let e=0;e<t.elements.length;e++){let a=t.elements[e];if(!a.validity.valid)return a}return null}function ee(t){let{description:e,errorMessage:a,isInvalid:r,validationState:v}=t,{labelProps:l,fieldProps:o}=j(t),n=D([!!e,!!a,r,v]),u=D([!!e,!!a,r,v]);return o=U(o,{"aria-describedby":[n,u,t["aria-describedby"]].filter(Boolean).join(" ")||void 0}),{labelProps:l,fieldProps:o,descriptionProps:{id:n},errorMessageProps:{id:u}}}const ae=c.createContext(null);export{ae as $,X as a,ee as b,_ as c,L as d,m as e,Z as f,x as g};
