import{o as G,h as H,g as W,i as y,f as x,p as C,q as M,r as S,b as V}from"./useFocus-bBgo0bKd.js";import{r as o}from"./index-CgfFrydU.js";function P(){let c=o.useRef(new Map),g=o.useCallback((t,n,i,e)=>{let a=e!=null&&e.once?(...d)=>{c.current.delete(i),i(...d)}:i;c.current.set(i,{type:n,eventTarget:t,fn:a,options:e}),t.addEventListener(n,a,e)},[]),u=o.useCallback((t,n,i,e)=>{var a;let d=((a=c.current.get(i))===null||a===void 0?void 0:a.fn)||i;t.removeEventListener(n,d,e),c.current.delete(i)},[]),l=o.useCallback(()=>{c.current.forEach((t,n)=>{u(t.eventTarget,t.type,n,t.options)})},[u]);return o.useEffect(()=>l,[l]),{addGlobalListener:g,removeGlobalListener:u,removeAllGlobalListeners:l}}function k(c){let{isDisabled:g,onBlurWithin:u,onFocusWithin:l,onFocusWithinChange:t}=c,n=o.useRef({isFocusWithin:!1}),{addGlobalListener:i,removeAllGlobalListeners:e}=P(),a=o.useCallback(s=>{s.currentTarget.contains(s.target)&&n.current.isFocusWithin&&!s.currentTarget.contains(s.relatedTarget)&&(n.current.isFocusWithin=!1,e(),u&&u(s),t&&t(!1))},[u,t,n,e]),d=G(a),$=o.useCallback(s=>{if(!s.currentTarget.contains(s.target))return;const p=H(s.target),f=W(p);if(!n.current.isFocusWithin&&f===y(s.nativeEvent)){l&&l(s),t&&t(!0),n.current.isFocusWithin=!0,d(s);let b=s.currentTarget;i(p,"focus",r=>{if(n.current.isFocusWithin&&!x(b,r.target)){let v=new C("blur",new p.defaultView.FocusEvent("blur",{relatedTarget:r.target}));v.target=b,v.currentTarget=b,a(v)}},{capture:!0})}},[l,t,d,i,a]);return g?{focusWithinProps:{onFocus:void 0,onBlur:void 0}}:{focusWithinProps:{onFocus:$,onBlur:a}}}let E=!1,F=0;function T(){E=!0,setTimeout(()=>{E=!1},50)}function L(c){c.pointerType==="touch"&&T()}function w(){if(!(typeof document>"u"))return typeof PointerEvent<"u"?document.addEventListener("pointerup",L):document.addEventListener("touchend",T),F++,()=>{F--,!(F>0)&&(typeof PointerEvent<"u"?document.removeEventListener("pointerup",L):document.removeEventListener("touchend",T))}}function B(c){let{onHoverStart:g,onHoverChange:u,onHoverEnd:l,isDisabled:t}=c,[n,i]=o.useState(!1),e=o.useRef({isHovered:!1,ignoreEmulatedMouseEvents:!1,pointerType:"",target:null}).current;o.useEffect(w,[]);let{addGlobalListener:a,removeAllGlobalListeners:d}=P(),{hoverProps:$,triggerHoverEnd:s}=o.useMemo(()=>{let p=(r,v)=>{if(e.pointerType=v,t||v==="touch"||e.isHovered||!r.currentTarget.contains(r.target))return;e.isHovered=!0;let h=r.currentTarget;e.target=h,a(H(r.target),"pointerover",m=>{e.isHovered&&e.target&&!x(e.target,m.target)&&f(m,m.pointerType)},{capture:!0}),g&&g({type:"hoverstart",target:h,pointerType:v}),u&&u(!0),i(!0)},f=(r,v)=>{let h=e.target;e.pointerType="",e.target=null,!(v==="touch"||!e.isHovered||!h)&&(e.isHovered=!1,d(),l&&l({type:"hoverend",target:h,pointerType:v}),u&&u(!1),i(!1))},b={};return typeof PointerEvent<"u"?(b.onPointerEnter=r=>{E&&r.pointerType==="mouse"||p(r,r.pointerType)},b.onPointerLeave=r=>{!t&&r.currentTarget.contains(r.target)&&f(r,r.pointerType)}):(b.onTouchStart=()=>{e.ignoreEmulatedMouseEvents=!0},b.onMouseEnter=r=>{!e.ignoreEmulatedMouseEvents&&!E&&p(r,"mouse"),e.ignoreEmulatedMouseEvents=!1},b.onMouseLeave=r=>{!t&&r.currentTarget.contains(r.target)&&f(r,"mouse")}),{hoverProps:b,triggerHoverEnd:f}},[g,u,l,t,e,a,d]);return o.useEffect(()=>{t&&s({currentTarget:e.target},e.pointerType)},[t]),{hoverProps:$,isHovered:n}}function I(c={}){let{autoFocus:g=!1,isTextInput:u,within:l}=c,t=o.useRef({isFocused:!1,isFocusVisible:g||M()}),[n,i]=o.useState(!1),[e,a]=o.useState(()=>t.current.isFocused&&t.current.isFocusVisible),d=o.useCallback(()=>a(t.current.isFocused&&t.current.isFocusVisible),[]),$=o.useCallback(f=>{t.current.isFocused=f,i(f),d()},[d]);S(f=>{t.current.isFocusVisible=f,d()},[],{isTextInput:u});let{focusProps:s}=V({isDisabled:l,onFocusChange:$}),{focusWithinProps:p}=k({isDisabled:!l,onFocusWithinChange:$});return{isFocused:n,isFocusVisible:e,focusProps:l?p:s}}export{k as $,B as a,I as b,P as c};
