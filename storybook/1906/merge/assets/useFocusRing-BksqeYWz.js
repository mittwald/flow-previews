import{c as y}from"./index-CYdVJgGQ.js";import{r,R as C}from"./iframe-DBKYLzDC.js";import{l as G,d as L,m as H,n as k,o as W,p as R,q as S,h as V,r as I,i as w}from"./useFocus-TYDADYlM.js";function P(){let u=r.useRef(new Map),d=r.useCallback((e,s,c,t)=>{let l=t?.once?(...f)=>{u.current.delete(c),c(...f)}:c;u.current.set(c,{type:s,eventTarget:e,fn:l,options:t}),e.addEventListener(s,l,t)},[]),o=r.useCallback((e,s,c,t)=>{var l;let f=((l=u.current.get(c))===null||l===void 0?void 0:l.fn)||c;e.removeEventListener(s,f,t),u.current.delete(c)},[]),n=r.useCallback(()=>{u.current.forEach((e,s)=>{o(e.eventTarget,e.type,s,e.options)})},[o]);return r.useEffect(()=>n,[n]),{addGlobalListener:d,removeGlobalListener:o,removeAllGlobalListeners:n}}var m;const D=(m=C.useInsertionEffect)!==null&&m!==void 0?m:y;function z(u){const d=r.useRef(null);return D(()=>{d.current=u},[u]),r.useCallback((...o)=>{const n=d.current;return n?.(...o)},[])}function A(u){let{isDisabled:d,onBlurWithin:o,onFocusWithin:n,onFocusWithinChange:e}=u,s=r.useRef({isFocusWithin:!1}),{addGlobalListener:c,removeAllGlobalListeners:t}=P(),l=r.useCallback(a=>{a.currentTarget.contains(a.target)&&s.current.isFocusWithin&&!a.currentTarget.contains(a.relatedTarget)&&(s.current.isFocusWithin=!1,t(),o&&o(a),e&&e(!1))},[o,e,s,t]),f=G(l),g=r.useCallback(a=>{if(!a.currentTarget.contains(a.target))return;const v=L(a.target),b=H(v);if(!s.current.isFocusWithin&&b===k(a.nativeEvent)){n&&n(a),e&&e(!0),s.current.isFocusWithin=!0,f(a);let h=a.currentTarget;c(v,"focus",i=>{if(s.current.isFocusWithin&&!W(h,i.target)){let $=new v.defaultView.FocusEvent("blur",{relatedTarget:i.target});R($,h);let p=S($);l(p)}},{capture:!0})}},[n,e,f,c,l]);return d?{focusWithinProps:{onFocus:void 0,onBlur:void 0}}:{focusWithinProps:{onFocus:g,onBlur:l}}}let T=!1,E=0;function B(){T=!0,setTimeout(()=>{T=!1},50)}function x(u){u.pointerType==="touch"&&B()}function M(){if(!(typeof document>"u"))return E===0&&typeof PointerEvent<"u"&&document.addEventListener("pointerup",x),E++,()=>{E--,!(E>0)&&typeof PointerEvent<"u"&&document.removeEventListener("pointerup",x)}}function J(u){let{onHoverStart:d,onHoverChange:o,onHoverEnd:n,isDisabled:e}=u,[s,c]=r.useState(!1),t=r.useRef({isHovered:!1,ignoreEmulatedMouseEvents:!1,pointerType:"",target:null}).current;r.useEffect(M,[]);let{addGlobalListener:l,removeAllGlobalListeners:f}=P(),{hoverProps:g,triggerHoverEnd:a}=r.useMemo(()=>{let v=(i,$)=>{if(t.pointerType=$,e||$==="touch"||t.isHovered||!i.currentTarget.contains(i.target))return;t.isHovered=!0;let p=i.currentTarget;t.target=p,l(L(i.target),"pointerover",F=>{t.isHovered&&t.target&&!W(t.target,F.target)&&b(F,F.pointerType)},{capture:!0}),d&&d({type:"hoverstart",target:p,pointerType:$}),o&&o(!0),c(!0)},b=(i,$)=>{let p=t.target;t.pointerType="",t.target=null,!($==="touch"||!t.isHovered||!p)&&(t.isHovered=!1,f(),n&&n({type:"hoverend",target:p,pointerType:$}),o&&o(!1),c(!1))},h={};return typeof PointerEvent<"u"&&(h.onPointerEnter=i=>{T&&i.pointerType==="mouse"||v(i,i.pointerType)},h.onPointerLeave=i=>{!e&&i.currentTarget.contains(i.target)&&b(i,i.pointerType)}),{hoverProps:h,triggerHoverEnd:b}},[d,o,n,e,t,l,f]);return r.useEffect(()=>{e&&a({currentTarget:t.target},t.pointerType)},[e]),{hoverProps:g,isHovered:s}}function K(u={}){let{autoFocus:d=!1,isTextInput:o,within:n}=u,e=r.useRef({isFocused:!1,isFocusVisible:d||V()}),[s,c]=r.useState(!1),[t,l]=r.useState(()=>e.current.isFocused&&e.current.isFocusVisible),f=r.useCallback(()=>l(e.current.isFocused&&e.current.isFocusVisible),[]),g=r.useCallback(b=>{e.current.isFocused=b,c(b),f()},[f]);I(b=>{e.current.isFocusVisible=b,f()},[],{isTextInput:o});let{focusProps:a}=w({isDisabled:n,onFocusChange:g}),{focusWithinProps:v}=A({isDisabled:!n,onFocusWithinChange:g});return{isFocused:s,isFocusVisible:t,focusProps:n?v:a}}export{J as $,K as a,z as b,A as c,P as d};
