import{j as r,r as q}from"./iframe-DBKYLzDC.js";import{M as C}from"./Markdown-B3QG7YKg.js";import{T as V}from"./TextArea-BhasccHH.js";import{N as T,K as v,O as D,P as O,Q as R}from"./IconWarning-BvGiLcXk.js";import{B as E}from"./Button-BFOZVdd1.js";import{$ as L}from"./useLocalizedStringFormatter-DY0sD44g.js";import{c as F}from"./clsx-B-dksMZM.js";import{f as U,I as H}from"./flowComponent-B-1S5Ra8.js";import{b as K}from"./utils-BUG9eo0Q.js";import{u as z}from"./useControlledHostValueProps-v0KkbD9s.js";const W=[["path",{d:"M6 15h15",key:"svg-0"}],["path",{d:"M21 19h-15",key:"svg-1"}],["path",{d:"M15 11h6",key:"svg-2"}],["path",{d:"M21 7h-6",key:"svg-3"}],["path",{d:"M9 9h1a1 1 0 1 1 -1 1v-2.5a2 2 0 0 1 2 -2",key:"svg-4"}],["path",{d:"M3 9h1a1 1 0 1 1 -1 1v-2.5a2 2 0 0 1 2 -2",key:"svg-5"}]],A=T("outline","blockquote","Blockquote",W);const Q=[["path",{d:"M7 5h6a3.5 3.5 0 0 1 0 7h-6l0 -7",key:"svg-0"}],["path",{d:"M13 12h1a3.5 3.5 0 0 1 0 7h-7v-7",key:"svg-1"}]],Z=T("outline","bold","Bold",Q);const G=[["path",{d:"M11 5l6 0",key:"svg-0"}],["path",{d:"M7 19l6 0",key:"svg-1"}],["path",{d:"M14 5l-4 14",key:"svg-2"}]],J=T("outline","italic","Italic",G);const X=[["path",{d:"M11 6h9",key:"svg-0"}],["path",{d:"M11 12h9",key:"svg-1"}],["path",{d:"M12 18h8",key:"svg-2"}],["path",{d:"M4 16a2 2 0 1 1 4 0c0 .591 -.5 1 -1 1.5l-3 2.5h4",key:"svg-3"}],["path",{d:"M6 10v-6l-2 2",key:"svg-4"}]],Y=T("outline","list-numbers","ListNumbers",X);const ee=[["path",{d:"M5 12l14 0",key:"svg-0"}],["path",{d:"M16 6.5a4 2 0 0 0 -4 -1.5h-1a3.5 3.5 0 0 0 0 7h2a3.5 3.5 0 0 1 0 7h-1.5a4 2 0 0 1 -4 -1.5",key:"svg-1"}]],te=T("outline","strikethrough","Strikethrough",ee),ne="flow--markdown-editor",oe="flow--markdown-editor--toolbar",se="flow--markdown-editor--toolbar-buttons",re="flow--markdown-editor--mode-button",ie="flow--markdown-editor--markdown",S={markdownEditor:ne,toolbar:oe,toolbarButtons:se,modeButton:re,markdown:ie,"mode-editor":"flow--markdown-editor--mode-editor","mode-preview":"flow--markdown-editor--mode-preview"},le={bold:{before:"**",after:"**",toggleable:!0},italic:{before:"_",after:"_",toggleable:!0},strikeThrough:{before:"~~",after:"~~",toggleable:!0},quote:{before:"> "},code:{before:"`",after:"`",toggleable:!0},link:{before:"[",after:"](https://)"},unorderedList:{before:"- "},orderedList:{before:"1. "}},$=(e,o)=>{const d=e.lastIndexOf(`
`,o-1);return d===-1?0:d+1},B=(e,o)=>{const d=e.indexOf(`
`,o);return d===-1?e.length:d},ae=(e="",o,d)=>{if(!d.current)return{newValue:e,newSelectionStart:null,newSelectionEnd:null};const g=d.current,{before:a,after:h="",toggleable:M=!1}=le[o],t=g.selectionStart,c=g.selectionEnd,s=e.substring(t,c),f=s.split(`
`);let u=e,n=t,i=c;if(o==="code"&&s.includes(`
`))u=e.substring(0,t)+"```\n"+s+"\n```\n"+e.substring(c),n=t+4,i=n+s.length;else if(o==="orderedList")if(s){const l=f.map((p,b)=>`${b+1}. ${p}`).join(`
`);u=e.substring(0,t)+l+e.substring(c),n=t,i=t+l.length}else{const l=$(e,t),p=B(e,t),b=`1. ${e.substring(l,p)}`;u=e.substring(0,l)+a+e.substring(l),n=l+b.length,i=n}else if(o==="unorderedList")if(s){const l=f.map(p=>`${a}${p}`).join(`
`);u=e.substring(0,t)+l+e.substring(c),n=t,i=t+l.length}else{const l=$(e,t),p=B(e,t),b=`- ${e.substring(l,p)}`;u=e.substring(0,l)+a+e.substring(l),n=l+b.length,i=n}else if(o==="quote")if(s){const l=f.map(p=>`${a}${p}`).join(`
`);u=e.substring(0,t)+l+e.substring(c),n=t,i=t+l.length}else{const l=`
${a} `;u=e.substring(0,t)+l+e.substring(c),n=t+l.length,i=n}else if(M){const l=e.substring(t-a.length,t),p=e.substring(c,c+h.length),b=l===a&&p===h,y=s.startsWith(a)&&s.endsWith(h);if(b)u=e.substring(0,t-a.length)+s+e.substring(c+h.length),n=t-a.length,i=n+s.length;else if(y){const x=s.slice(a.length,s.length-h.length);u=e.substring(0,t)+x+e.substring(c),n=t,i=t+x.length}else u=e.substring(0,t)+a+s+h+e.substring(c),s.length===0?(n=t+a.length,i=n):(n=t+a.length,i=n+s.length)}else if(o==="link"){let l="",p="",b="",y=0;s?(w=>{try{return new URL(w),!0}catch{return!1}})(s)?(p=s,b=`[](${p})`,y=t+1):(l=s,b=`[${l}]()`,y=t+b.indexOf("](")+2):(b="[](https://)",y=t+1),u=e.substring(0,t)+b+e.substring(c),n=i=y}else u=e.substring(0,t)+a+s+h+e.substring(c),s.length===0?(n=t+a.length,i=n):(n=t+a.length,i=n+s.length);return{newValue:u,newSelectionStart:n,newSelectionEnd:i}},P={"de-DE":{"mode.editor":"Vorschau beenden","mode.preview":"Vorschau","toolbar.bold":"Fett","toolbar.code":"Code","toolbar.italic":"Kursiv","toolbar.link":"Link","toolbar.orderedList":"Sortierte Liste","toolbar.quote":"Zitat","toolbar.strikeThrough":"Durchgestrichen","toolbar.unorderedList":"Liste"},"en-US":{"mode.editor":"Exit Preview","mode.preview":"Preview","toolbar.bold":"Bold","toolbar.code":"Code","toolbar.italic":"Italic","toolbar.link":"Link","toolbar.orderedList":"Ordered List","toolbar.quote":"Quote","toolbar.strikeThrough":"Strike through","toolbar.unorderedList":"List"}},m=e=>{const{children:o,type:d,onPress:g,...a}=e,h=L(P);return r.jsx(E,{...a,"data-button-type":d,"aria-label":h.format(`toolbar.${d}`),size:"s",variant:"plain",color:"dark",onPress:()=>g?.(d),children:o})};m.__docgenInfo={description:"",methods:[],displayName:"ToolbarButton",props:{type:{required:!0,tsType:{name:"InsertType"},description:""},onPress:{required:!1,tsType:{name:"signature",type:"function",raw:"(type: InsertType) => void",signature:{arguments:[{type:{name:"InsertType"},name:"type"}],return:{name:"void"}}},description:""}},composes:["Pick"]};const I=e=>{const{currentMode:o,onChange:d,...g}=e,a=L(P),h=o==="editor"?"preview":"editor";return r.jsx(E,{className:S.modeButton,size:"s",variant:"plain",color:"dark",onPress:()=>{d?.(h)},...g,children:a.format(`mode.${h}`)})};I.__docgenInfo={description:"",methods:[],displayName:"ModeButton",props:{currentMode:{required:!0,tsType:{name:"MarkdownEditorMode"},description:""},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(newMode: MarkdownEditorMode) => void",signature:{arguments:[{type:{name:"MarkdownEditorMode"},name:"newMode"}],return:{name:"void"}}},description:""}},composes:["Pick"]};const N=e=>{const o={onPress:e.onToolPressed,isDisabled:e.isDisabled||e.currentMode==="preview"};return r.jsxs("header",{className:S.toolbar,role:"toolbar",children:[r.jsxs("div",{className:S.toolbarButtons,children:[r.jsx(m,{...o,type:"bold",children:r.jsx(v,{children:r.jsx(Z,{})})}),r.jsx(m,{...o,type:"italic",children:r.jsx(v,{children:r.jsx(J,{})})}),r.jsx(m,{...o,type:"strikeThrough",children:r.jsx(v,{children:r.jsx(te,{})})}),r.jsx(m,{...o,type:"quote",children:r.jsx(v,{children:r.jsx(A,{})})}),r.jsx(m,{...o,type:"code",children:r.jsx(D,{})}),r.jsx(m,{...o,type:"link",children:r.jsx(O,{})}),r.jsx(m,{...o,type:"unorderedList",children:r.jsx(v,{children:r.jsx(R,{})})}),r.jsx(m,{...o,type:"orderedList",children:r.jsx(v,{children:r.jsx(Y,{})})})]}),r.jsx(I,{onChange:e.onModeChange,currentMode:e.currentMode,isDisabled:e.isDisabled})]})};N.__docgenInfo={description:"",methods:[],displayName:"Toolbar",props:{currentMode:{required:!0,tsType:{name:'ModeButtonProps["currentMode"]',raw:'ModeButtonProps["currentMode"]'},description:""},onModeChange:{required:!0,tsType:{name:'ModeButtonProps["onChange"]',raw:'ModeButtonProps["onChange"]'},description:""},onToolPressed:{required:!0,tsType:{name:'ToolBarButtonProps["onPress"]',raw:'ToolBarButtonProps["onPress"]'},description:""}},composes:["Pick"]};const ce=(e="",o)=>{const{selectionStart:d}=o,g=parseInt(getComputedStyle(o).lineHeight||"20",10),a=e.slice(0,d).split(`
`).length;o.scrollTop=(a-1)*g},de=(e="",o)=>{const d=o.current;if(!d)return;const g=d.selectionStart,a=d.selectionEnd,h=e.slice(0,g),M=e.slice(a),t=h.lastIndexOf(`
`)+1,c=h.slice(t),s=c.match(/^(\s*)(\d+)\.\s+/),f=c.match(/^(\s*)([-*+])\s+/);if((s||f)&&c.trim().match(/^([-*+]|\d+\.)$/))return{newValue:e.slice(0,t)+`
`+M,newSelectionStart:t+1,newSelectionEnd:t+1};if(s){const u=s[1],n=parseInt(s[2]??"",10)+1,i=`
${u}${n}. `;return{newValue:h+i+M,newSelectionStart:g+i.length,newSelectionEnd:g+i.length}}else if(f){const u=f[1],n=f[2],i=`
${u}${n} `;return{newValue:h+i+M,newSelectionStart:g+i.length,newSelectionEnd:g+i.length}}},ue=U("MarkdownEditor",e=>{const{isDisabled:o,isReadOnly:d,children:g,className:a,rows:h=5,autoResizeMaxRows:M,headingOffset:t,value:c,onChange:s,ref:f,...u}=z(e),n=K(f),[i,l]=q.useState("editor"),p=F(S.markdownEditor,a,S[`mode-${i}`]),b=x=>{if(x.key!=="Enter")return;const w=de(c,n);if(!w)return;const{newValue:j,newSelectionStart:k,newSelectionEnd:_}=w;requestAnimationFrame(()=>{n.current&&(n.current.value=j,n.current?.setSelectionRange(k,_),ce(j,n.current))}),x.preventDefault(),s(j)},y=x=>{const{newValue:w,newSelectionStart:j,newSelectionEnd:k}=ae(c,x,n);requestAnimationFrame(()=>{n.current&&(n.current.value=w,n.current.setSelectionRange(j,k),n.current.focus())}),s(w)};return r.jsx("div",{className:p,children:r.jsx(H,{children:r.jsxs(V,{...u,"aria-hidden":i==="preview",isReadOnly:d||i==="preview",isDisabled:o,ref:n,value:c,rows:h,autoResizeMaxRows:M,onChange:s,onKeyDown:b,children:[i==="preview"&&r.jsx(C,{headingOffset:t,className:S.markdown,style:{height:n.current?.offsetHeight},children:c}),g,r.jsx(N,{currentMode:i,isDisabled:o,onModeChange:l,onToolPressed:y})]})})})});ue.__docgenInfo={description:"@flr-generate all",methods:[],displayName:"MarkdownEditor"};export{ue as M};
