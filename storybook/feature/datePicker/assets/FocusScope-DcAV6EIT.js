import{d as I,e as E,f as P}from"./useFocusable-1hkoevAF.js";import{e as w}from"./flowComponent-Dglj5cqB.js";import{r as h,R as y}from"./index-BwDkhjyp.js";function V(t){const e=I(t);if(!(t instanceof e.HTMLElement)&&!(t instanceof e.SVGElement))return!1;let{display:r,visibility:o}=t.style,n=r!=="none"&&o!=="hidden"&&o!=="collapse";if(n){const{getComputedStyle:l}=t.ownerDocument.defaultView;let{display:c,visibility:a}=l(t);n=c!=="none"&&a!=="hidden"&&a!=="collapse"}return n}function B(t,e){return!t.hasAttribute("hidden")&&!t.hasAttribute("data-react-aria-prevent-focus")&&(t.nodeName==="DETAILS"&&e&&e.nodeName!=="SUMMARY"?t.hasAttribute("open"):!0)}function K(t,e){return t.nodeName!=="#comment"&&V(t)&&B(t,e)&&(!t.parentElement||K(t.parentElement,t))}const A=y.createContext(null);let f=null;function Z(t){let{children:e,contain:r,restoreFocus:o,autoFocus:n}=t,l=h.useRef(null),c=h.useRef(null),a=h.useRef([]),{parentNode:s}=h.useContext(A)||{},i=h.useMemo(()=>new C({scopeRef:a}),[a]);w(()=>{let v=s||p.root;if(p.getTreeNode(v.scopeRef)&&f&&!L(f,v.scopeRef)){let b=p.getTreeNode(f);b&&(v=b)}v.addChild(i),p.addNode(i)},[i,s]),w(()=>{let v=p.getTreeNode(a);v&&(v.contain=!!r)},[r]),w(()=>{var v;let b=(v=l.current)===null||v===void 0?void 0:v.nextSibling,N=[];for(;b&&b!==c.current;)N.push(b),b=b.nextSibling;a.current=N},[e]),W(a,o,r),H(a,r),J(a,o,r),U(a,n),h.useEffect(()=>{const v=E(a.current?a.current[0]:void 0).activeElement;let b=null;if($(v,a.current)){for(let N of p.traverse())N.scopeRef&&$(v,N.scopeRef.current)&&(b=N);b===p.getTreeNode(a)&&(f=b.scopeRef)}},[a]),w(()=>()=>{var v,b,N;let F=(N=(b=p.getTreeNode(a))===null||b===void 0||(v=b.parent)===null||v===void 0?void 0:v.scopeRef)!==null&&N!==void 0?N:null;(a===f||L(a,f))&&(!F||p.getTreeNode(F))&&(f=F),p.removeTreeNode(a)},[a]);let u=h.useMemo(()=>j(a),[]),d=h.useMemo(()=>({focusManager:u,parentNode:i}),[i,u]);return y.createElement(A.Provider,{value:d},y.createElement("span",{"data-focus-scope-start":!0,hidden:!0,ref:l}),e,y.createElement("span",{"data-focus-scope-end":!0,hidden:!0,ref:c}))}function j(t){return{focusNext(e={}){let r=t.current,{from:o,tabbable:n,wrap:l,accept:c}=e,a=o||E(r[0]).activeElement,s=r[0].previousElementSibling,i=g(r),u=T(i,{tabbable:n,accept:c},r);u.currentNode=$(a,r)?a:s;let d=u.nextNode();return!d&&l&&(u.currentNode=s,d=u.nextNode()),d&&m(d,!0),d},focusPrevious(e={}){let r=t.current,{from:o,tabbable:n,wrap:l,accept:c}=e,a=o||E(r[0]).activeElement,s=r[r.length-1].nextElementSibling,i=g(r),u=T(i,{tabbable:n,accept:c},r);u.currentNode=$(a,r)?a:s;let d=u.previousNode();return!d&&l&&(u.currentNode=s,d=u.previousNode()),d&&m(d,!0),d},focusFirst(e={}){let r=t.current,{tabbable:o,accept:n}=e,l=g(r),c=T(l,{tabbable:o,accept:n},r);c.currentNode=r[0].previousElementSibling;let a=c.nextNode();return a&&m(a,!0),a},focusLast(e={}){let r=t.current,{tabbable:o,accept:n}=e,l=g(r),c=T(l,{tabbable:o,accept:n},r);c.currentNode=r[r.length-1].nextElementSibling;let a=c.previousNode();return a&&m(a,!0),a}}}const M=["input:not([disabled]):not([type=hidden])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[contenteditable]"],z=M.join(":not([hidden]),")+",[tabindex]:not([disabled]):not([hidden])";M.push('[tabindex]:not([tabindex="-1"]):not([disabled])');const q=M.join(':not([hidden]):not([tabindex="-1"]),');function g(t){return t[0].parentElement}function x(t){let e=p.getTreeNode(f);for(;e&&e.scopeRef!==t;){if(e.contain)return!1;e=e.parent}return!0}function H(t,e){let r=h.useRef(),o=h.useRef();w(()=>{let n=t.current;if(!e){o.current&&(cancelAnimationFrame(o.current),o.current=void 0);return}const l=E(n?n[0]:void 0);let c=i=>{if(i.key!=="Tab"||i.altKey||i.ctrlKey||i.metaKey||!x(t)||i.isComposing)return;let u=l.activeElement,d=t.current;if(!d||!$(u,d))return;let v=g(d),b=T(v,{tabbable:!0},d);if(!u)return;b.currentNode=u;let N=i.shiftKey?b.previousNode():b.nextNode();N||(b.currentNode=i.shiftKey?d[d.length-1].nextElementSibling:d[0].previousElementSibling,N=i.shiftKey?b.previousNode():b.nextNode()),i.preventDefault(),N&&m(N,!0)},a=i=>{(!f||L(f,t))&&$(i.target,t.current)?(f=t,r.current=i.target):x(t)&&!S(i.target,t)?r.current?r.current.focus():f&&f.current&&R(f.current):x(t)&&(r.current=i.target)},s=i=>{o.current&&cancelAnimationFrame(o.current),o.current=requestAnimationFrame(()=>{if(l.activeElement&&x(t)&&!S(l.activeElement,t))if(f=t,l.body.contains(i.target)){var u;r.current=i.target,(u=r.current)===null||u===void 0||u.focus()}else f.current&&R(f.current)})};return l.addEventListener("keydown",c,!1),l.addEventListener("focusin",a,!1),n==null||n.forEach(i=>i.addEventListener("focusin",a,!1)),n==null||n.forEach(i=>i.addEventListener("focusout",s,!1)),()=>{l.removeEventListener("keydown",c,!1),l.removeEventListener("focusin",a,!1),n==null||n.forEach(i=>i.removeEventListener("focusin",a,!1)),n==null||n.forEach(i=>i.removeEventListener("focusout",s,!1))}},[t,e]),w(()=>()=>{o.current&&cancelAnimationFrame(o.current)},[o])}function D(t){return S(t)}function $(t,e){return!t||!e?!1:e.some(r=>r.contains(t))}function S(t,e=null){if(t instanceof Element&&t.closest("[data-react-aria-top-layer]"))return!0;for(let{scopeRef:r}of p.traverse(p.getTreeNode(e)))if(r&&$(t,r.current))return!0;return!1}function O(t){return S(t,f)}function L(t,e){var r;let o=(r=p.getTreeNode(e))===null||r===void 0?void 0:r.parent;for(;o;){if(o.scopeRef===t)return!0;o=o.parent}return!1}function m(t,e=!1){if(t!=null&&!e)try{P(t)}catch{}else if(t!=null)try{t.focus()}catch{}}function R(t,e=!0){let r=t[0].previousElementSibling,o=g(t),n=T(o,{tabbable:e},t);n.currentNode=r;let l=n.nextNode();e&&!l&&(o=g(t),n=T(o,{tabbable:!1},t),n.currentNode=r,l=n.nextNode()),m(l)}function U(t,e){const r=y.useRef(e);h.useEffect(()=>{if(r.current){f=t;const o=E(t.current?t.current[0]:void 0);!$(o.activeElement,f.current)&&t.current&&R(t.current)}r.current=!1},[t])}function W(t,e,r){w(()=>{if(e||r)return;let o=t.current;const n=E(o?o[0]:void 0);let l=c=>{let a=c.target;$(a,t.current)?f=t:D(a)||(f=null)};return n.addEventListener("focusin",l,!1),o==null||o.forEach(c=>c.addEventListener("focusin",l,!1)),()=>{n.removeEventListener("focusin",l,!1),o==null||o.forEach(c=>c.removeEventListener("focusin",l,!1))}},[t,e,r])}function G(t){let e=p.getTreeNode(f);for(;e&&e.scopeRef!==t;){if(e.nodeToRestore)return!1;e=e.parent}return(e==null?void 0:e.scopeRef)===t}function J(t,e,r){const o=h.useRef(typeof document<"u"?E(t.current?t.current[0]:void 0).activeElement:null);w(()=>{let n=t.current;const l=E(n?n[0]:void 0);if(!e||r)return;let c=()=>{(!f||L(f,t))&&$(l.activeElement,t.current)&&(f=t)};return l.addEventListener("focusin",c,!1),n==null||n.forEach(a=>a.addEventListener("focusin",c,!1)),()=>{l.removeEventListener("focusin",c,!1),n==null||n.forEach(a=>a.removeEventListener("focusin",c,!1))}},[t,r]),w(()=>{const n=E(t.current?t.current[0]:void 0);if(!e)return;let l=c=>{if(c.key!=="Tab"||c.altKey||c.ctrlKey||c.metaKey||!x(t)||c.isComposing)return;let a=n.activeElement;if(!$(a,t.current))return;let s=p.getTreeNode(t);if(!s)return;let i=s.nodeToRestore,u=T(n.body,{tabbable:!0});u.currentNode=a;let d=c.shiftKey?u.previousNode():u.nextNode();if((!i||!n.body.contains(i)||i===n.body)&&(i=void 0,s.nodeToRestore=void 0),(!d||!$(d,t.current))&&i){u.currentNode=i;do d=c.shiftKey?u.previousNode():u.nextNode();while($(d,t.current));c.preventDefault(),c.stopPropagation(),d?m(d,!0):D(i)?m(i,!0):a.blur()}};return r||n.addEventListener("keydown",l,!0),()=>{r||n.removeEventListener("keydown",l,!0)}},[t,e,r]),w(()=>{const n=E(t.current?t.current[0]:void 0);if(!e)return;let l=p.getTreeNode(t);if(l){var c;return l.nodeToRestore=(c=o.current)!==null&&c!==void 0?c:void 0,()=>{let a=p.getTreeNode(t);if(!a)return;let s=a.nodeToRestore;if(e&&s&&($(n.activeElement,t.current)||n.activeElement===n.body&&G(t))){let i=p.clone();requestAnimationFrame(()=>{if(n.activeElement===n.body){let u=i.getTreeNode(t);for(;u;){if(u.nodeToRestore&&u.nodeToRestore.isConnected){m(u.nodeToRestore);return}u=u.parent}for(u=i.getTreeNode(t);u;){if(u.scopeRef&&u.scopeRef.current&&p.getTreeNode(u.scopeRef)){R(u.scopeRef.current,!0);return}u=u.parent}}})}}}},[t,e])}function T(t,e,r){let o=e!=null&&e.tabbable?q:z,n=E(t).createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode(l){var c;return!(e==null||(c=e.from)===null||c===void 0)&&c.contains(l)?NodeFilter.FILTER_REJECT:l.matches(o)&&K(l)&&(!r||$(l,r))&&(!(e!=null&&e.accept)||e.accept(l))?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});return e!=null&&e.from&&(n.currentNode=e.from),n}function ee(t,e={}){return{focusNext(r={}){let o=t.current;if(!o)return null;let{from:n,tabbable:l=e.tabbable,wrap:c=e.wrap,accept:a=e.accept}=r,s=n||E(o).activeElement,i=T(o,{tabbable:l,accept:a});o.contains(s)&&(i.currentNode=s);let u=i.nextNode();return!u&&c&&(i.currentNode=o,u=i.nextNode()),u&&m(u,!0),u},focusPrevious(r=e){let o=t.current;if(!o)return null;let{from:n,tabbable:l=e.tabbable,wrap:c=e.wrap,accept:a=e.accept}=r,s=n||E(o).activeElement,i=T(o,{tabbable:l,accept:a});if(o.contains(s))i.currentNode=s;else{let d=_(i);return d&&m(d,!0),d??null}let u=i.previousNode();if(!u&&c){i.currentNode=o;let d=_(i);if(!d)return null;u=d}return u&&m(u,!0),u??null},focusFirst(r=e){let o=t.current;if(!o)return null;let{tabbable:n=e.tabbable,accept:l=e.accept}=r,a=T(o,{tabbable:n,accept:l}).nextNode();return a&&m(a,!0),a},focusLast(r=e){let o=t.current;if(!o)return null;let{tabbable:n=e.tabbable,accept:l=e.accept}=r,c=T(o,{tabbable:n,accept:l}),a=_(c);return a&&m(a,!0),a??null}}}function _(t){let e,r;do r=t.lastChild(),r&&(e=r);while(r);return e}class k{get size(){return this.fastMap.size}getTreeNode(e){return this.fastMap.get(e)}addTreeNode(e,r,o){let n=this.fastMap.get(r??null);if(!n)return;let l=new C({scopeRef:e});n.addChild(l),l.parent=n,this.fastMap.set(e,l),o&&(l.nodeToRestore=o)}addNode(e){this.fastMap.set(e.scopeRef,e)}removeTreeNode(e){if(e===null)return;let r=this.fastMap.get(e);if(!r)return;let o=r.parent;for(let l of this.traverse())l!==r&&r.nodeToRestore&&l.nodeToRestore&&r.scopeRef&&r.scopeRef.current&&$(l.nodeToRestore,r.scopeRef.current)&&(l.nodeToRestore=r.nodeToRestore);let n=r.children;o&&(o.removeChild(r),n.size>0&&n.forEach(l=>o&&o.addChild(l))),this.fastMap.delete(r.scopeRef)}*traverse(e=this.root){if(e.scopeRef!=null&&(yield e),e.children.size>0)for(let r of e.children)yield*this.traverse(r)}clone(){var e;let r=new k;var o;for(let n of this.traverse())r.addTreeNode(n.scopeRef,(o=(e=n.parent)===null||e===void 0?void 0:e.scopeRef)!==null&&o!==void 0?o:null,n.nodeToRestore);return r}constructor(){this.fastMap=new Map,this.root=new C({scopeRef:null}),this.fastMap.set(null,this.root)}}class C{addChild(e){this.children.add(e),e.parent=this}removeChild(e){this.children.delete(e),e.parent=void 0}constructor(e){this.children=new Set,this.contain=!1,this.scopeRef=e.scopeRef}}let p=new k;export{T as $,Z as a,O as b,ee as c};
