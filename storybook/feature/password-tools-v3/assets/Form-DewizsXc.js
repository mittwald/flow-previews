import{r as v}from"./iframe-BBx9-gCC.js";import{D as R}from"./useFocus-BXsHwCAW.js";import{b as T,c as y,g as D,$ as U}from"./mergeRefs-CjwhAStn.js";import{a as j}from"./useLabel-CF_pOETX.js";const h={badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1,valid:!0},B={...h,customError:!0,valid:!1},$={isInvalid:!1,validationDetails:h,validationErrors:[]},F=v.createContext({}),L="__formValidationState"+Date.now();function X(i){if(i[L]){let{realtimeValidation:e,displayValidation:a,updateValidation:t,resetValidation:s,commitValidation:r}=i[L];return{realtimeValidation:e,displayValidation:a,updateValidation:t,resetValidation:s,commitValidation:r}}return Q(i)}function Q(i){let{isInvalid:e,validationState:a,name:t,value:s,builtinValidation:r,validate:o,validationBehavior:n="aria"}=i;a&&(e||(e=a==="invalid"));let l=e!==void 0?{isInvalid:e,validationErrors:[],validationDetails:B}:null,c=v.useMemo(()=>{if(!o||s==null)return null;let d=k(o,s);return C(d)},[o,s]);r!=null&&r.validationDetails.valid&&(r=void 0);let u=v.useContext(F),f=v.useMemo(()=>t?Array.isArray(t)?t.flatMap(d=>M(u[d])):M(u[t]):[],[u,t]),[P,w]=v.useState(u),[x,b]=v.useState(!1);u!==P&&(w(u),b(!1));let p=v.useMemo(()=>C(x?[]:f),[x,f]),S=v.useRef($),[V,E]=v.useState($),m=v.useRef($),A=()=>{if(!O)return;g(!1);let d=c||r||S.current;I(d,m.current)||(m.current=d,E(d))},[O,g]=v.useState(!1);return v.useEffect(A),{realtimeValidation:l||p||c||r||$,displayValidation:n==="native"?l||p||V:l||p||c||r||V,updateValidation(d){n==="aria"&&!I(V,d)?E(d):S.current=d},resetValidation(){let d=$;I(d,m.current)||(m.current=d,E(d)),n==="native"&&g(!1),b(!0)},commitValidation(){n==="native"&&g(!0),b(!0)}}}function M(i){return i?Array.isArray(i)?i:[i]:[]}function k(i,e){if(typeof i=="function"){let a=i(e);if(a&&typeof a!="boolean")return M(a)}return[]}function C(i){return i.length?{isInvalid:!0,validationErrors:i,validationDetails:B}:null}function I(i,e){return i===e?!0:!!i&&!!e&&i.isInvalid===e.isInvalid&&i.validationErrors.length===e.validationErrors.length&&i.validationErrors.every((a,t)=>a===e.validationErrors[t])&&Object.entries(i.validationDetails).every(([a,t])=>e.validationDetails[a]===t)}function Z(...i){let e=new Set,a=!1,t={...h};for(let o of i){var s,r;for(let n of o.validationErrors)e.add(n);a||(a=o.isInvalid);for(let n in t)(s=t)[r=n]||(s[r]=o.validationDetails[n])}return t.valid=!a,{isInvalid:a,validationErrors:[...e],validationDetails:t}}function _(i,e,a){let{validationBehavior:t,focus:s}=i;T(()=>{if(t==="native"&&(a!=null&&a.current)&&!a.current.disabled){let l=e.realtimeValidation.isInvalid?e.realtimeValidation.validationErrors.join(" ")||"Invalid value.":"";a.current.setCustomValidity(l),a.current.hasAttribute("title")||(a.current.title=""),e.realtimeValidation.isInvalid||e.updateValidation(N(a.current))}});let r=y(()=>{e.resetValidation()}),o=y(l=>{var c;e.displayValidation.isInvalid||e.commitValidation();let u=a==null||(c=a.current)===null||c===void 0?void 0:c.form;if(!l.defaultPrevented&&a&&u&&Y(u)===a.current){var f;s?s():(f=a.current)===null||f===void 0||f.focus(),R("keyboard")}l.preventDefault()}),n=y(()=>{e.commitValidation()});v.useEffect(()=>{let l=a==null?void 0:a.current;if(!l)return;let c=l.form;return l.addEventListener("invalid",o),l.addEventListener("change",n),c==null||c.addEventListener("reset",r),()=>{l.removeEventListener("invalid",o),l.removeEventListener("change",n),c==null||c.removeEventListener("reset",r)}},[a,o,n,r,t])}function q(i){let e=i.validity;return{badInput:e.badInput,customError:e.customError,patternMismatch:e.patternMismatch,rangeOverflow:e.rangeOverflow,rangeUnderflow:e.rangeUnderflow,stepMismatch:e.stepMismatch,tooLong:e.tooLong,tooShort:e.tooShort,typeMismatch:e.typeMismatch,valueMissing:e.valueMissing,valid:e.valid}}function N(i){return{isInvalid:!i.validity.valid,validationDetails:q(i),validationErrors:i.validationMessage?[i.validationMessage]:[]}}function Y(i){for(let e=0;e<i.elements.length;e++){let a=i.elements[e];if(!a.validity.valid)return a}return null}function ee(i){let{description:e,errorMessage:a,isInvalid:t,validationState:s}=i,{labelProps:r,fieldProps:o}=j(i),n=D([!!e,!!a,t,s]),l=D([!!e,!!a,t,s]);return o=U(o,{"aria-describedby":[n,l,i["aria-describedby"]].filter(Boolean).join(" ")||void 0}),{labelProps:r,fieldProps:o,descriptionProps:{id:n},errorMessageProps:{id:l}}}const ae=v.createContext(null);export{ae as $,X as a,ee as b,_ as c,L as d,$ as e,Z as f,h as g};
