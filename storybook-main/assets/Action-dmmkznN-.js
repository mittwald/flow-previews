var V=Object.defineProperty;var X=(t,e,n)=>e in t?V(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var c=(t,e,n)=>(X(t,typeof e!="symbol"?e+"":e,n),n);import{r as l,R as a}from"./index-uCp2LrAq.js";import{m as q,o as _,b as f}from"./flowComponent-BGkoX5us.js";import{u as B}from"./useSelector-DEtWbfIK.js";import{P as R}from"./PropsContextProvider-v92cY4my.js";import{W as Y}from"./Wrap-DQq6jo70.js";const W=l.createContext(void 0),de=W.Provider;class p{constructor(e=!1){c(this,"isOpen");q(this,{isOpen:_,open:f.bound,close:f.bound,toggle:f.bound,setOpen:f.bound}),this.isOpen=e}static useNew(e){return l.useRef(new p(e)).current}open(){this.isOpen=!0}close(){this.isOpen=!1}toggle(){this.isOpen=!this.isOpen}setOpen(e){this.isOpen=e}useIsOpen(){return B(()=>this.isOpen)}}const T=(t={})=>{const{reuseControllerFromContext:e=!0,defaultOpen:n}=t,o=p.useNew(n),s=l.useContext(W);return e&&s?s:o};class b{constructor(){c(this,"state","isIdle");q(this,{state:_,updateState:f})}static useNew(){return l.useRef(new b).current}updateState(e){this.state=e}useState(){return B(()=>this.state,[this])}}const $=l.createContext({actionProps:{},state:new b,overlayController:new p,confirmationModalController:new p,needsConfirmation:!1}),Z=$.Provider,C=()=>l.useContext($),ee=t=>{const e=C(),n=T(),o=b.useNew(),s=T();return l.useMemo(()=>({actionProps:t,parentContext:e,overlayController:n,state:o,confirmationModalController:s,needsConfirmation:!1}),[t,e,n,o,s])},m=()=>{},te=(t,e={})=>{const{onSync:n=m,onAsync:o=m,then:s=m,catch:r=m,finally:d=m}=e;try{const i=t();return i instanceof Promise?(o(),i.then(s).catch(r).finally(d)):(n(),s(i),d(),i)}catch(i){n(),r(i),d()}},N=t=>new Promise(e=>setTimeout(e,t)),O={pending:1e3,succeeded:1500,failed:2e3};class ne{constructor(e,n,o={}){c(this,"options");c(this,"state");c(this,"args");c(this,"isDone",!1);c(this,"error");const{resetAfterDone:s=!0,onFeedbackDone:r=()=>{},showFeedback:d=!1,resetDelayMs:i=0}=o;this.state=e,this.args=n,this.options={resetAfterDone:s,onFeedbackDone:r,showFeedback:d,resetDelayMs:i}}onAsyncStart(){this.options.showFeedback=!0,this.state.updateState("isExecuting"),setTimeout(()=>this.startPending(),O.pending)}onSucceeded(){return this.onDone()}async onFailed(e){this.error=e??new Error("Unknown error"),console.error(e),await this.onDone()}setResetDelay(e){this.options.resetDelayMs=e}async startFailedFeedback(){this.state.updateState("isFailed"),await N(O.failed),this.resetAfterDone()}async startSucceededFeedback(){this.state.updateState("isSucceeded"),await N(O.succeeded),this.resetAfterDone()}resetAfterDone(){setTimeout(()=>{this.options.resetAfterDone&&this.state.updateState("isIdle"),this.error||this.options.onFeedbackDone(...this.args)},this.options.resetDelayMs)}async onDone(){this.isDone=!0,this.options.showFeedback?this.error?await this.startFailedFeedback():await this.startSucceededFeedback():this.resetAfterDone()}startPending(){this.isDone||this.state.updateState("isPending")}}const L=t=>(...e)=>{const n=[...t],o=n.shift();if(o){const s=o(...e),r=()=>n.length===0?s:L(n)(...e);return s instanceof Promise?s.then(r):r()}},oe=()=>{},v=()=>{var n;const t=C(),e=t.actionProps.confirm||t.actionProps.abort?((n=t.parentContext)==null?void 0:n.state)??t.state:t.state;return{state:e,execute:async(...o)=>{var S;const{actionProps:s,confirmationModalController:r,needsConfirmation:d,parentContext:i}=t;if(s.abort){(S=i==null?void 0:i.confirmationModalController)==null||S.close();return}if(d&&!r.isOpen){r.open();return}const h=new ne(e,o,s),k=[];let u,x,y=t;for(;y;){const{actionProps:w,overlayController:J,confirmationModalController:D,needsConfirmation:K}=y,{action:E,toggleOverlay:F,openOverlay:P,closeOverlay:M,break:Q}=w;if(Q)break;if(K)if(u){x=D;break}else u=D;const g=I=>typeof I=="boolean"?J:I;k.push(E||(F?g(F).toggle:P?g(P).open:M?g(M).close:oe)),y=y.parentContext}const H=L(k);h.setResetDelay(u?500:0),await te(()=>H(o),{onAsync:()=>h.onAsyncStart(),then:async()=>{await h.onSucceeded(),x&&x.open(),u&&u.close()},catch:w=>h.onFailed(w)})}}},A=(t,e)=>{const{actionProps:n,needsConfirmation:o}=C(),s=v(),r=s.state.useState();return o?a.createElement(t,{...e,onPress:s.execute}):n.abort?a.createElement(t,{...e,onPress:s.execute,"aria-disabled":r!=="isIdle"}):a.createElement(t,{...e,onPress:s.execute,isPending:r==="isPending","aria-disabled":r==="isExecuting",isSucceeded:r==="isSucceeded",isFailed:r==="isFailed"})};A.__docgenInfo={description:"",methods:[],displayName:"ActionButton"};const G=(t,e)=>{const{needsConfirmation:n}=C(),o=v(),s=o.state.useState();return n?a.createElement(t,{...e,onPress:o.execute}):a.createElement(t,{...e,onPress:o.execute,"aria-disabled":s!=="isIdle"})};G.__docgenInfo={description:"",methods:[],displayName:"ActionLink"};const U=(t,e)=>{const n=e.color==="secondary",o=e.color==="primary"||e.color==="danger"||e.color==="accent";if(!o&&!n)return a.createElement(t,{...e});const s={Button:{render:A}};return a.createElement(R,{props:s},a.createElement(z,{abort:n,confirm:o},a.createElement(t,{...e})))};U.__docgenInfo={description:"",methods:[],displayName:"ConfirmationModalButton"};const j=(t,e)=>{if(e.slot!=="actionConfirm")return a.createElement(t,{...e});const n=C(),o=v().state.useState();l.useEffect(()=>(n.needsConfirmation=!0,()=>{n.needsConfirmation=!1}),[n]);const s=o==="isIdle"?e.isDismissable:!1;return a.createElement(t,{...e,controller:n.confirmationModalController,isDismissable:s})};j.__docgenInfo={description:"",methods:[],displayName:"ConfirmationModal"};const z=t=>{const{children:e,...n}=t,o=ee(n),s=!!o.parentContext&&!!o.parentContext.parentContext,r={Modal:{render:j,ButtonGroup:{Button:{render:U}}},Button:{render:A},Link:{render:G}};return a.createElement(Z,{value:o},a.createElement(Y,{if:!s},a.createElement(R,{props:r,dependencies:[o],mergeInParentContext:!0},e)))};z.__docgenInfo={description:"",methods:[],displayName:"Action",props:{action:{required:!1,tsType:{name:"signature",type:"function",raw:"(...args: unknown[]) => unknown",signature:{arguments:[{type:{name:"Array",elements:[{name:"unknown"}],raw:"unknown[]"},name:"args",rest:!0}],return:{name:"unknown"}}},description:""},closeOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},openOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},toggleOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},break:{required:!1,tsType:{name:"boolean"},description:""},showFeedback:{required:!1,tsType:{name:"boolean"},description:""},isConfirmationAction:{required:!1,tsType:{name:"boolean"},description:"@internal"},confirm:{required:!1,tsType:{name:"boolean"},description:"@internal"},abort:{required:!1,tsType:{name:"boolean"},description:"@internal"}},composes:["PropsWithChildren"]};export{z as A,de as O,T as u};
