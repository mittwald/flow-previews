import{h as te}from"./useFocusable-rZ2Ly5zk.js";import{$ as F}from"./number-nHrFdSb-.js";import{r as C,R as oe}from"./index-uCp2LrAq.js";import{d as Y}from"./index-CFQDndEx.js";import{$ as le}from"./useLocalizedStringFormatter-CHReNXSI.js";import{$ as re}from"./useControlledState-B8AA3oOY.js";import{a as ne,b as ae}from"./utils-DZgOXw50.js";function ie(){return typeof window.ResizeObserver<"u"}function ce(t){const{ref:e,onResize:o}=t;C.useEffect(()=>{let l=e==null?void 0:e.current;if(l)if(ie()){const r=new window.ResizeObserver(a=>{a.length&&o()});return r.observe(l),()=>{l&&r.unobserve(l)}}else return window.addEventListener("resize",o,!1),()=>{window.removeEventListener("resize",o,!1)}},[o,e])}const A={top:"top",bottom:"top",left:"left",right:"left"},k={top:"bottom",bottom:"top",left:"right",right:"left"},se={top:"left",left:"top"},X={top:"height",left:"width"},J={width:"totalWidth",height:"totalHeight"},O={};let L=typeof document<"u"&&window.visualViewport;function Z(t){let e=0,o=0,l=0,r=0,a=0,i=0,n={},d=(L==null?void 0:L.scale)>1;if(t.tagName==="BODY"){let g=document.documentElement;l=g.clientWidth,r=g.clientHeight;var c;e=(c=L==null?void 0:L.width)!==null&&c!==void 0?c:l;var p;o=(p=L==null?void 0:L.height)!==null&&p!==void 0?p:r,n.top=g.scrollTop||t.scrollTop,n.left=g.scrollLeft||t.scrollLeft,L&&(a=L.offsetTop,i=L.offsetLeft)}else({width:e,height:o,top:a,left:i}=M(t)),n.top=t.scrollTop,n.left=t.scrollLeft,l=e,r=o;return te()&&(t.tagName==="BODY"||t.tagName==="HTML")&&d&&(n.top=0,n.left=0,a=L.pageTop,i=L.pageLeft),{width:e,height:o,totalWidth:l,totalHeight:r,scroll:n,top:a,left:i}}function fe(t){return{top:t.scrollTop,left:t.scrollLeft,width:t.scrollWidth,height:t.scrollHeight}}function j(t,e,o,l,r,a,i){let n=r.scroll[t],d=l[X[t]],c=l.scroll[A[t]]+a,p=d+l.scroll[A[t]]-a,g=e-n+i[t]-l[A[t]],v=e-n+o+i[t]-l[A[t]];return g<c?c-g:v>p?Math.max(p-v,c-g):0}function pe(t){let e=window.getComputedStyle(t);return{top:parseInt(e.marginTop,10)||0,bottom:parseInt(e.marginBottom,10)||0,left:parseInt(e.marginLeft,10)||0,right:parseInt(e.marginRight,10)||0}}function U(t){if(O[t])return O[t];let[e,o]=t.split(" "),l=A[e]||"right",r=se[l];A[o]||(o="center");let a=X[l],i=X[r];return O[t]={placement:e,crossPlacement:o,axis:l,crossAxis:r,size:a,crossSize:i},O[t]}function N(t,e,o,l,r,a,i,n,d,c){let{placement:p,crossPlacement:g,axis:v,crossAxis:s,size:b,crossSize:h}=l,f={};f[s]=t[s],g==="center"?f[s]+=(t[h]-o[h])/2:g!==s&&(f[s]+=t[h]-o[h]),f[s]+=a;const P=t[s]-o[h]+d+c,u=t[s]+t[h]-d-c;if(f[s]=F(f[s],P,u),p===v){const w=n?i[b]:e[J[b]];f[k[v]]=Math.floor(w-t[v]+r)}else f[v]=Math.floor(t[v]+t[b]+r);return f}function de(t,e,o,l,r,a,i,n){const d=l?o.height:e[J.height];let c=t.top!=null?o.top+t.top:o.top+(d-t.bottom-i),p=n!=="top"?Math.max(0,e.height+e.top+e.scroll.top-c-(r.top+r.bottom+a)):Math.max(0,c+i-(e.top+e.scroll.top)-(r.top+r.bottom+a));return Math.min(e.height-a*2,p)}function B(t,e,o,l,r,a){let{placement:i,axis:n,size:d}=a;return i===n?Math.max(0,o[n]-t[n]-t.scroll[n]+e[n]-l[n]-l[k[n]]-r):Math.max(0,t[d]+t[n]+t.scroll[n]-e[n]-o[n]-o[d]-l[n]-l[k[n]]-r)}function ue(t,e,o,l,r,a,i,n,d,c,p,g,v,s,b,h){let f=U(t),{size:P,crossAxis:u,crossSize:w,placement:I,crossPlacement:T}=f,m=N(e,n,o,f,p,g,c,v,b,h),S=p,x=B(n,c,e,r,a+p,f);if(i&&l[P]>x){let y=U(`${k[I]} ${T}`),ee=N(e,n,o,y,p,g,c,v,b,h);B(n,c,e,r,a+p,y)>x&&(f=y,m=ee,S=p)}let E="bottom";f.axis==="top"?f.placement==="top"?E="top":f.placement==="bottom"&&(E="bottom"):f.crossAxis==="top"&&(f.crossPlacement==="top"?E="bottom":f.crossPlacement==="bottom"&&(E="top"));let R=j(u,m[u],o[w],n,d,a,c);m[u]+=R;let H=de(m,n,c,v,r,a,o.height,E);s&&s<H&&(H=s),o.height=Math.min(o.height,H),m=N(e,n,o,f,S,g,c,v,b,h),R=j(u,m[u],o[w],n,d,a,c),m[u]+=R;let z={},K=e[u]+.5*e[w]-m[u];const Q=b/2+h,W=o[w]-b/2-h,V=e[u]-m[u]+b/2,D=e[u]+e[w]-m[u]-b/2,_=F(K,V,D);return z[u]=F(_,Q,W),{position:m,maxHeight:H,arrowOffsetLeft:z.left,arrowOffsetTop:z.top,placement:f.placement}}function me(t){let{placement:e,targetNode:o,overlayNode:l,scrollNode:r,padding:a,shouldFlip:i,boundaryElement:n,offset:d,crossOffset:c,maxHeight:p,arrowSize:g=0,arrowBoundaryOffset:v=0}=t,s=l instanceof HTMLElement?$e(l):document.documentElement,b=s===document.documentElement;const h=window.getComputedStyle(s).position;let f=!!h&&h!=="static",P=b?M(o):G(o,s);if(!b){let{marginTop:x,marginLeft:E}=window.getComputedStyle(o);P.top+=parseInt(x,10)||0,P.left+=parseInt(E,10)||0}let u=M(l),w=pe(l);u.width+=w.left+w.right,u.height+=w.top+w.bottom;let I=fe(r),T=Z(n),m=Z(s),S=n.tagName==="BODY"?M(s):G(s,n);return s.tagName==="HTML"&&n.tagName==="BODY"&&(m.scroll.top=0,m.scroll.left=0),ue(e,P,u,I,w,a,i,T,m,S,d,c,f,p,g,v)}function M(t){let{top:e,left:o,width:l,height:r}=t.getBoundingClientRect(),{scrollTop:a,scrollLeft:i,clientTop:n,clientLeft:d}=document.documentElement;return{top:e+a-n,left:o+i-d,width:l,height:r}}function G(t,e){let o=window.getComputedStyle(t),l;if(o.position==="fixed"){let{top:r,left:a,width:i,height:n}=t.getBoundingClientRect();l={top:r,left:a,width:i,height:n}}else{l=M(t);let r=M(e),a=window.getComputedStyle(e);r.top+=(parseInt(a.borderTopWidth,10)||0)-e.scrollTop,r.left+=(parseInt(a.borderLeftWidth,10)||0)-e.scrollLeft,l.top-=r.top,l.left-=r.left}return l.top-=parseInt(o.marginTop,10)||0,l.left-=parseInt(o.marginLeft,10)||0,l}function $e(t){let e=t.offsetParent;if(e&&e===document.body&&window.getComputedStyle(e).position==="static"&&!q(e)&&(e=document.documentElement),e==null)for(e=t.parentElement;e&&!q(e);)e=e.parentElement;return e||document.documentElement}function q(t){let e=window.getComputedStyle(t);return e.transform!=="none"||/transform|perspective/.test(e.willChange)||e.filter!=="none"||e.contain==="paint"||"backdropFilter"in e&&e.backdropFilter!=="none"||"WebkitBackdropFilter"in e&&e.WebkitBackdropFilter!=="none"}const ge=new WeakMap;function he(t){let{triggerRef:e,isOpen:o,onClose:l}=t;C.useEffect(()=>{if(!o||l===null)return;let r=a=>{let i=a.target;if(!e.current||i instanceof Node&&!i.contains(e.current))return;let n=l||ge.get(e.current);n&&n()};return window.addEventListener("scroll",r,!0),()=>{window.removeEventListener("scroll",r,!0)}},[o,l,e])}let $=typeof document<"u"&&window.visualViewport;function Se(t){let{direction:e}=le(),{arrowSize:o=0,targetRef:l,overlayRef:r,scrollRef:a=r,placement:i="bottom",containerPadding:n=12,shouldFlip:d=!0,boundaryElement:c=typeof document<"u"?document.body:null,offset:p=0,crossOffset:g=0,shouldUpdatePosition:v=!0,isOpen:s=!0,onClose:b,maxHeight:h,arrowBoundaryOffset:f=0}=t,[P,u]=C.useState({position:{},arrowOffsetLeft:void 0,arrowOffsetTop:void 0,maxHeight:void 0,placement:void 0}),w=[v,i,r.current,l.current,a.current,n,d,c,p,g,s,e,h,f,o],I=C.useRef($==null?void 0:$.scale);C.useEffect(()=>{s&&(I.current=$==null?void 0:$.scale)},[s]);let T=C.useCallback(()=>{if(v===!1||!s||!r.current||!l.current||!a.current||!c||($==null?void 0:$.scale)!==I.current)return;let x=r.current;if(!h&&r.current){var E;x.style.top="0px",x.style.bottom="";var R;x.style.maxHeight=((R=(E=window.visualViewport)===null||E===void 0?void 0:E.height)!==null&&R!==void 0?R:window.innerHeight)+"px"}let H=me({placement:be(i,e),overlayNode:r.current,targetNode:l.current,scrollNode:a.current,padding:n,shouldFlip:d,boundaryElement:c,offset:p,crossOffset:g,maxHeight:h,arrowSize:o,arrowBoundaryOffset:f});x.style.top="",x.style.bottom="",Object.keys(H.position).forEach(z=>x.style[z]=H.position[z]+"px"),x.style.maxHeight=H.maxHeight!=null?H.maxHeight+"px":void 0,u(H)},w);Y(T,w),ve(T),ce({ref:r,onResize:T});let m=C.useRef(!1);Y(()=>{let x,E=()=>{m.current=!0,clearTimeout(x),x=setTimeout(()=>{m.current=!1},500),T()},R=()=>{m.current&&E()};return $==null||$.addEventListener("resize",E),$==null||$.addEventListener("scroll",R),()=>{$==null||$.removeEventListener("resize",E),$==null||$.removeEventListener("scroll",R)}},[T]);let S=C.useCallback(()=>{m.current||b()},[b,m]);return he({triggerRef:l,isOpen:s,onClose:b&&S}),{overlayProps:{style:{position:"absolute",zIndex:1e5,...P.position,maxHeight:P.maxHeight}},placement:P.placement,arrowProps:{"aria-hidden":"true",role:"presentation",style:{left:P.arrowOffsetLeft,top:P.arrowOffsetTop}},updatePosition:T}}function ve(t){Y(()=>(window.addEventListener("resize",t,!1),()=>{window.removeEventListener("resize",t,!1)}),[t])}function be(t,e){return e==="rtl"?t.replace("start","right").replace("end","left"):t.replace("start","left").replace("end","right")}function ze(t){let[e,o]=re(t.isOpen,t.defaultOpen||!1,t.onOpenChange);const l=C.useCallback(()=>{o(!0)},[o]),r=C.useCallback(()=>{o(!1)},[o]),a=C.useCallback(()=>{o(!e)},[o,e]);return{isOpen:e,setOpen:o,open:l,close:r,toggle:a}}const we=C.createContext({placement:"bottom"});function xe(t,e){[t,e]=ne(t,e,we);let o=t.placement,l={position:"absolute",[o]:"100%",transform:o==="top"||o==="bottom"?"translateX(-50%)":"translateY(-50%)"},r=ae({...t,defaultClassName:"react-aria-OverlayArrow",values:{placement:o}});return r.style&&Object.keys(r.style).forEach(a=>r.style[a]===void 0&&delete r.style[a]),oe.createElement("div",{...t,...r,style:{...l,...r.style},ref:e,"data-placement":o})}const Ae=C.forwardRef(xe);export{Ae as $,ze as a,Se as b,we as c,ce as d,ge as e};
