var Q=Object.defineProperty;var V=(t,e,n)=>e in t?Q(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var c=(t,e,n)=>(V(t,typeof e!="symbol"?e+"":e,n),n);import{r as l,R as a}from"./index-uCp2LrAq.js";import{b as q,o as _,c as m,P as B}from"./flowComponent-vzWTOrGV.js";import{u as R}from"./useSelector-DLNdgzbT.js";import{W as X}from"./Wrap-DQq6jo70.js";const W=l.createContext(void 0),ce=W.Provider;class f{constructor(e=!1){c(this,"isOpen");q(this,{isOpen:_,open:m.bound,close:m.bound,toggle:m.bound,setOpen:m.bound}),this.isOpen=e}static useNew(e){return l.useRef(new f(e)).current}open(){this.isOpen=!0}close(){this.isOpen=!1}toggle(){this.isOpen=!this.isOpen}setOpen(e){this.isOpen=e}useIsOpen(){return R(()=>this.isOpen)}}const N=(t={})=>{const{reuseControllerFromContext:e=!0,defaultOpen:n}=t,o=f.useNew(n),s=l.useContext(W);return e&&s?s:o};class y{constructor(){c(this,"state","isIdle");q(this,{state:_,updateState:m})}static useNew(){return l.useRef(new y).current}updateState(e){this.state=e}useState(){return R(()=>this.state,[this])}}const $=l.createContext({actionProps:{},state:new y,overlayController:new f,confirmationModalController:new f,needsConfirmation:!1}),Y=$.Provider,p=()=>l.useContext($),Z=t=>{const e=p(),n=N(),o=y.useNew(),s=N();return l.useMemo(()=>({actionProps:t,parentContext:e,overlayController:n,state:o,confirmationModalController:s,needsConfirmation:!1}),[t,e,n,o,s])},u=()=>{},ee=(t,e={})=>{const{onSync:n=u,onAsync:o=u,then:s=u,catch:r=u,finally:d=u}=e;try{const i=t();return i instanceof Promise?(o(),i.then(s).catch(r).finally(d)):(n(),s(i),d(),i)}catch(i){n(),r(i),d()}},T=t=>new Promise(e=>setTimeout(e,t)),O={pending:1e3,succeeded:1500,failed:2e3};class te{constructor(e,n,o={}){c(this,"options");c(this,"state");c(this,"args");c(this,"isDone",!1);c(this,"error");const{resetAfterDone:s=!0,onFeedbackDone:r=()=>{},showFeedback:d=!1}=o;this.state=e,this.args=n,this.options={resetAfterDone:s,onFeedbackDone:r,showFeedback:d}}onAsyncStart(){this.options.showFeedback=!0,this.state.updateState("isExecuting"),setTimeout(()=>this.startPending(),O.pending)}onSucceeded(){return this.onDone()}async onFailed(e){this.error=e??new Error("Unknown error"),console.error(e),await this.onDone()}async startFailedFeedback(){this.state.updateState("isFailed"),await T(O.failed),this.resetAfterDone()}async startSucceededFeedback(){this.state.updateState("isSucceeded"),await T(O.succeeded),this.resetAfterDone()}resetAfterDone(){this.options.resetAfterDone&&this.state.updateState("isIdle"),this.error||this.options.onFeedbackDone(...this.args)}async onDone(){this.isDone=!0,this.options.showFeedback?this.error?await this.startFailedFeedback():await this.startSucceededFeedback():this.resetAfterDone()}startPending(){this.isDone||this.state.updateState("isPending")}}const L=t=>(...e)=>{const n=[...t],o=n.shift();if(o){const s=o(...e),r=()=>n.length===0?s:L(n)(...e);return s instanceof Promise?s.then(r):r()}},ne=()=>{},v=()=>{var n;const t=p(),e=t.actionProps.confirm||t.actionProps.abort?((n=t.parentContext)==null?void 0:n.state)??t.state:t.state;return{state:e,execute:async(...o)=>{var S;const{actionProps:s,confirmationModalController:r,needsConfirmation:d,parentContext:i}=t;if(s.abort){(S=i==null?void 0:i.confirmationModalController)==null||S.close();return}if(d&&!r.isOpen){r.open();return}const b=new te(e,o,s),k=[];let C,x,h=t;for(;h;){const{actionProps:w,overlayController:H,confirmationModalController:E,needsConfirmation:J}=h,{action:F,toggleOverlay:P,openOverlay:D,closeOverlay:M,break:K}=w;if(K)break;if(J)if(C){x=E;break}else C=E;const g=I=>typeof I=="boolean"?H:I;k.push(F||(P?g(P).toggle:D?g(D).open:M?g(M).close:ne)),h=h.parentContext}await ee(()=>L(k)(o),{onAsync:()=>b.onAsyncStart(),then:()=>b.onSucceeded(),catch:w=>b.onFailed(w)}),x&&x.open(),C&&C.close()}}},A=(t,e)=>{const{actionProps:n,needsConfirmation:o}=p(),s=v(),r=s.state.useState();return o?a.createElement(t,{...e,onPress:s.execute}):n.abort?a.createElement(t,{...e,onPress:s.execute,"aria-disabled":r!=="isIdle"}):a.createElement(t,{...e,onPress:s.execute,isPending:r==="isPending","aria-disabled":r==="isExecuting",isSucceeded:r==="isSucceeded",isFailed:r==="isFailed"})};A.__docgenInfo={description:"",methods:[],displayName:"ActionButton"};const G=(t,e)=>{const{needsConfirmation:n}=p(),o=v(),s=o.state.useState();return n?a.createElement(t,{...e,onPress:o.execute}):a.createElement(t,{...e,onPress:o.execute,"aria-disabled":s!=="isIdle"})};G.__docgenInfo={description:"",methods:[],displayName:"ActionLink"};const U=(t,e)=>{const n=e.color==="secondary",o=e.color==="primary"||e.color==="danger"||e.color==="accent";if(!o&&!n)return a.createElement(t,{...e});const s={Button:{render:A}};return a.createElement(B,{props:s},a.createElement(z,{abort:n,confirm:o},a.createElement(t,{...e})))};U.__docgenInfo={description:"",methods:[],displayName:"ConfirmationModalButton"};const j=(t,e)=>{if(e.slot!=="actionConfirm")return a.createElement(t,{...e});const n=p(),o=v().state.useState();l.useEffect(()=>(n.needsConfirmation=!0,()=>{n.needsConfirmation=!1}),[n]);const s=o==="isIdle"?e.isDismissable:!1;return a.createElement(t,{...e,controller:n.confirmationModalController,isDismissable:s})};j.__docgenInfo={description:"",methods:[],displayName:"ConfirmationModal"};const z=t=>{const{children:e,...n}=t,o=Z(n),s=!!o.parentContext&&!!o.parentContext.parentContext,r={Modal:{render:j,ButtonGroup:{Button:{render:U}}},Button:{render:A},Link:{render:G}};return a.createElement(Y,{value:o},a.createElement(X,{if:!s},a.createElement(B,{props:r,dependencies:[o],mergeInParentContext:!0},e)))};z.__docgenInfo={description:"",methods:[],displayName:"Action",props:{action:{required:!1,tsType:{name:"signature",type:"function",raw:"(...args: unknown[]) => unknown",signature:{arguments:[{type:{name:"Array",elements:[{name:"unknown"}],raw:"unknown[]"},name:"args",rest:!0}],return:{name:"unknown"}}},description:""},closeOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},openOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},toggleOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},break:{required:!1,tsType:{name:"boolean"},description:""},showFeedback:{required:!1,tsType:{name:"boolean"},description:""},isConfirmationAction:{required:!1,tsType:{name:"boolean"},description:"@internal"},confirm:{required:!1,tsType:{name:"boolean"},description:"@internal"},abort:{required:!1,tsType:{name:"boolean"},description:"@internal"}},composes:["PropsWithChildren"]};export{z as A,ce as O,N as u};
