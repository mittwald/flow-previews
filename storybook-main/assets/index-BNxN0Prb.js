var P=Object.defineProperty;var D=(t,e,n)=>e in t?P(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var m=(t,e,n)=>(D(t,typeof e!="symbol"?e+"":e,n),n);import{r as p,R as i}from"./index-BwDkhjyp.js";import{m as O,o as w,i as y,N as T,P as q,A as M}from"./flowComponent-BLFgELHw.js";import{u as k}from"./useSelector-qoCwTusO.js";class b{constructor(e=!1){m(this,"isOpen");O(this,{isOpen:w,open:y.bound,close:y.bound,toggle:y.bound,setOpen:y.bound}),this.isOpen=e}static useNew(e){return p.useState(new b(e))[0]}open(){this.isOpen=!0}close(){this.isOpen=!1}toggle(){this.isOpen=!this.isOpen}setOpen(e){this.isOpen=e}useIsOpen(){return k(()=>this.isOpen)}}const g=p.createContext(void 0),K=g.Provider,I=(t={})=>{const{reuseControllerFromContext:e=!0,defaultOpen:n}=t,r=b.useNew(n),o=p.useContext(g);return e&&o?o:r},F=p.createContext(void 0),N=()=>p.useContext(F),R=F.Provider,S=t=>(...e)=>{const n=[...t],r=n.shift();if(r){const o=r(...e),s=()=>n.length===0?o:S(n)(...e);return o instanceof Promise?o.then(s):s()}},E="flowBreakActionMarker";function B(t){return!!t&&t instanceof Error&&t.message===E}const $=()=>{throw new Error(E)},C={pending:1e3,succeeded:1500,failed:2e3};class W{constructor(e,n,r={}){m(this,"options");m(this,"state");m(this,"args");m(this,"isDone",!1);m(this,"error");const{resetAfterDone:o=!0,onFeedbackDone:s=()=>{},showFeedback:l=!1}=r;this.state=e,this.args=n,this.options={resetAfterDone:o,onFeedbackDone:s,showFeedback:l}}onAsyncStart(){this.options.showFeedback=!0,this.state.updateState("isExecuting"),setTimeout(()=>this.startPending(),C.pending)}onSucceeded(){this.onDone()}onFailed(e){this.error=e??new Error("Unknown error"),console.error(e),this.onDone()}startFailedFeedback(){B(this.error)?this.resetAfterDone():(this.state.updateState("isFailed"),setTimeout(()=>this.resetAfterDone(),C.failed))}startSucceededFeedback(){this.state.updateState("isSucceeded"),setTimeout(()=>this.resetAfterDone(),C.succeeded)}resetAfterDone(){this.options.resetAfterDone&&this.state.updateState("isIdle"),this.error||this.options.onFeedbackDone(...this.args)}onDone(){this.isDone=!0,this.options.showFeedback?this.error?this.startFailedFeedback():this.startSucceededFeedback():this.resetAfterDone()}startPending(){this.isDone||this.state.updateState("isPending")}}class A{constructor(){m(this,"state","isIdle");O(this,{state:w,updateState:y})}static useNew(){return p.useRef(new A).current}updateState(e){this.state=e}useState(){return k(()=>this.state,[this])}}const _=()=>{},G=t=>{const{action:e,toggleOverlay:n,openOverlay:r,closeOverlay:o,break:s}=t,l=I(),a=f=>typeof f=="boolean"?l:f;return e||(n?a(n).toggle:r?a(r).open:o?a(o).close:s?$:_)},H=(t,e={})=>{const{onSync:n=()=>{},onAsync:r=()=>{},then:o=()=>{},catch:s=()=>{},finally:l=()=>{}}=e;try{const a=t();return a instanceof Promise?(r(),a.then(o).catch(s).finally(l)):(n(),o(a),l(),a)}catch(a){n(),s(a),l()}},L=t=>{const{isConfirmationAction:e,showFeedback:n}=t,r=G(t),o=N(),s=A.useNew(),l=!e,a=e?void 0:o,f=e?o:void 0,d=S([r,a]);return{callAction:(...c)=>{const v=new W(s,c,{onFeedbackDone:f,resetAfterDone:l,showFeedback:n});return H(d,{onAsync:()=>v.onAsyncStart(),then:()=>v.onSucceeded(),catch:x=>v.onFailed(x)})},state:s}},h=t=>{const[e,n]=p.useState(!1),r=b.useNew(),o=L(t),s=e?r.open:o.callAction,f={Link:{onPress:s},Button:{onPress:s,render:(d,u)=>{const c=o.state.useState();return i.createElement(d,{...u,isPending:c==="isPending"?!0:void 0,"aria-disabled":c!=="isIdle"?!0:void 0,isSucceeded:c==="isSucceeded"?!0:void 0,isFailed:c==="isFailed"?!0:void 0})}},Modal:{tunnelId:"outsideActionProvider",render:(d,u)=>{const c=u.slot==="actionConfirm";return p.useEffect(()=>{if(c)return n(!0),()=>{n(!1)}},[c]),c?i.createElement(d,{controller:r,...u}):i.createElement(d,{...u})},ButtonGroup:{Button:{render:(d,u)=>{const{color:c}=u;return c==="secondary"?i.createElement(h,{break:!0},i.createElement(h,{closeOverlay:!0},i.createElement(d,{...u}))):i.createElement(h,{closeOverlay:!0},i.createElement(h,{...t,isConfirmationAction:!0},i.createElement(d,{...u})))}}}}};return i.createElement(T,null,i.createElement(q,{props:f,dependencies:[e],mergeInParentContext:!0},i.createElement(R,{value:s},t.children),i.createElement(M,{id:"outsideActionProvider"})))};h.__docgenInfo={description:"",methods:[],displayName:"Action",props:{action:{required:!1,tsType:{name:"signature",type:"function",raw:"(...args: unknown[]) => unknown",signature:{arguments:[{type:{name:"Array",elements:[{name:"unknown"}],raw:"unknown[]"},name:"args",rest:!0}],return:{name:"unknown"}}},description:""},closeOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},openOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},toggleOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},break:{required:!1,tsType:{name:"boolean"},description:""},showFeedback:{required:!1,tsType:{name:"boolean"},description:""},isConfirmationAction:{required:!1,tsType:{name:"boolean"},description:"@internal"}},composes:["PropsWithChildren"]};h.__docgenInfo={description:"",methods:[],displayName:"Action",props:{action:{required:!1,tsType:{name:"signature",type:"function",raw:"(...args: unknown[]) => unknown",signature:{arguments:[{type:{name:"Array",elements:[{name:"unknown"}],raw:"unknown[]"},name:"args",rest:!0}],return:{name:"unknown"}}},description:""},closeOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},openOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},toggleOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},break:{required:!1,tsType:{name:"boolean"},description:""},showFeedback:{required:!1,tsType:{name:"boolean"},description:""},isConfirmationAction:{required:!1,tsType:{name:"boolean"},description:"@internal"}},composes:["PropsWithChildren"]};export{h as A,K as O,I as u};
