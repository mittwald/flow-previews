var T=Object.defineProperty;var q=(t,e,n)=>e in t?T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var p=(t,e,n)=>(q(t,typeof e!="symbol"?e+"":e,n),n);import{r as m,R as i}from"./index-uCp2LrAq.js";import{p as M,m as w,o as k,b,c as I,N,P as R,A as B}from"./flowComponent-C3iYbsVA.js";import{u as g}from"./useSelector-BmBRWWfN.js";function $(){return M(Object.values,arguments)}class v{constructor(e=!1){p(this,"isOpen");w(this,{isOpen:k,open:b.bound,close:b.bound,toggle:b.bound,setOpen:b.bound}),this.isOpen=e}static useNew(e){return m.useState(new v(e))[0]}open(){this.isOpen=!0}close(){this.isOpen=!1}toggle(){this.isOpen=!this.isOpen}setOpen(e){this.isOpen=e}useIsOpen(){return g(()=>this.isOpen)}}const F=m.createContext(void 0),Z=F.Provider,W=(t={})=>{const{reuseControllerFromContext:e=!0,defaultOpen:n}=t,r=v.useNew(n),o=m.useContext(F);return e&&o?o:r},S=m.createContext(void 0),_=()=>m.useContext(S),j=S.Provider,E=t=>(...e)=>{const n=[...t],r=n.shift();if(r){const o=r(...e),s=()=>n.length===0?o:E(n)(...e);return o instanceof Promise?o.then(s):s()}},x="flowBreakActionMarker";function G(t){return!!t&&t instanceof Error&&t.message===x}const H=()=>{throw new Error(x)},O={pending:1e3,succeeded:1500,failed:2e3};class L{constructor(e,n,r={}){p(this,"options");p(this,"state");p(this,"args");p(this,"isDone",!1);p(this,"error");const{resetAfterDone:o=!0,onFeedbackDone:s=()=>{},showFeedback:u=!1}=r;this.state=e,this.args=n,this.options={resetAfterDone:o,onFeedbackDone:s,showFeedback:u}}onAsyncStart(){this.options.showFeedback=!0,this.state.updateState("isExecuting"),setTimeout(()=>this.startPending(),O.pending)}onSucceeded(){this.onDone()}onFailed(e){this.error=e??new Error("Unknown error"),console.error(e),this.onDone()}startFailedFeedback(){G(this.error)?this.resetAfterDone():(this.state.updateState("isFailed"),setTimeout(()=>this.resetAfterDone(),O.failed))}startSucceededFeedback(){this.state.updateState("isSucceeded"),setTimeout(()=>this.resetAfterDone(),O.succeeded)}resetAfterDone(){this.options.resetAfterDone&&this.state.updateState("isIdle"),this.error||this.options.onFeedbackDone(...this.args)}onDone(){this.isDone=!0,this.options.showFeedback?this.error?this.startFailedFeedback():this.startSucceededFeedback():this.resetAfterDone()}startPending(){this.isDone||this.state.updateState("isPending")}}class A{constructor(){p(this,"state","isIdle");w(this,{state:k,updateState:b})}static useNew(){return m.useRef(new A).current}updateState(e){this.state=e}useState(){return g(()=>this.state,[this])}}const U=()=>{},z=t=>{const{action:e,toggleOverlay:n,openOverlay:r,closeOverlay:o,break:s}=t,u=W(),a=f=>typeof f=="boolean"?u:f;return e||(n?a(n).toggle:r?a(r).open:o?a(o).close:s?H:U)},y=()=>{},J=(t,e={})=>{const{onSync:n=y,onAsync:r=y,then:o=y,catch:s=y,finally:u=y}=e;try{const a=t();return a instanceof Promise?(r(),a.then(o).catch(s).finally(u)):(n(),o(a),u(),a)}catch(a){n(),s(a),u()}},K=t=>{const{isConfirmationAction:e,showFeedback:n}=t,r=z(t),o=_(),s=A.useNew(),u=!e,a=e?void 0:o,f=e?o:void 0,d=E([r,a]),l=(...D)=>{const C=new L(s,D,{onFeedbackDone:f,resetAfterDone:u,showFeedback:n});return J(d,{onAsync:()=>C.onAsyncStart(),then:()=>C.onSucceeded(),catch:P=>C.onFailed(P)})},c=$(I(t,["children"]));return m.useMemo(()=>({callAction:l,state:s}),c)},h=t=>{const[e,n]=m.useState(!1),r=v.useNew(),o=K(t),s=e?r.open:o.callAction,f={Link:{onPress:s},Button:{onPress:s,render:(d,l)=>{const c=o.state.useState();return i.createElement(d,{...l,isPending:c==="isPending"?!0:void 0,"aria-disabled":c!=="isIdle"?!0:void 0,isSucceeded:c==="isSucceeded"?!0:void 0,isFailed:c==="isFailed"?!0:void 0})}},Modal:{tunnelId:"outsideActionProvider",render:(d,l)=>{const c=l.slot==="actionConfirm";return m.useEffect(()=>{if(c)return n(!0),()=>{n(!1)}},[c]),c?i.createElement(d,{controller:r,...l}):i.createElement(d,{...l})},ButtonGroup:{Button:{render:(d,l)=>{const{color:c}=l;return c==="secondary"?i.createElement(h,{break:!0},i.createElement(h,{closeOverlay:!0},i.createElement(d,{...l}))):i.createElement(h,{closeOverlay:!0},i.createElement(h,{...t,isConfirmationAction:!0},i.createElement(d,{...l})))}}}}};return i.createElement(N,null,i.createElement(R,{props:f,dependencies:[e,o],mergeInParentContext:!0},i.createElement(j,{value:s},t.children),i.createElement(B,{id:"outsideActionProvider"})))};h.__docgenInfo={description:"",methods:[],displayName:"Action",props:{action:{required:!1,tsType:{name:"signature",type:"function",raw:"(...args: unknown[]) => unknown",signature:{arguments:[{type:{name:"Array",elements:[{name:"unknown"}],raw:"unknown[]"},name:"args",rest:!0}],return:{name:"unknown"}}},description:""},closeOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},openOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},toggleOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},break:{required:!1,tsType:{name:"boolean"},description:""},showFeedback:{required:!1,tsType:{name:"boolean"},description:""},isConfirmationAction:{required:!1,tsType:{name:"boolean"},description:"@internal"}},composes:["PropsWithChildren"]};h.__docgenInfo={description:"",methods:[],displayName:"Action",props:{action:{required:!1,tsType:{name:"signature",type:"function",raw:"(...args: unknown[]) => unknown",signature:{arguments:[{type:{name:"Array",elements:[{name:"unknown"}],raw:"unknown[]"},name:"args",rest:!0}],return:{name:"unknown"}}},description:""},closeOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},openOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},toggleOverlay:{required:!1,tsType:{name:"union",raw:"boolean | OverlayController",elements:[{name:"boolean"},{name:"OverlayController"}]},description:""},break:{required:!1,tsType:{name:"boolean"},description:""},showFeedback:{required:!1,tsType:{name:"boolean"},description:""},isConfirmationAction:{required:!1,tsType:{name:"boolean"},description:"@internal"}},composes:["PropsWithChildren"]};export{h as A,Z as O,W as u};
